<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://github.com/lyf110/notes/cloud/mq/rocketmq/RocketMQ-01.html"><meta property="og:site_name" content="lyf blog"><meta property="og:title" content="一、RocketMQ入门第一天"><meta property="og:description" content="1. MQ介绍 1.1 为什么要用MQ 消息队列是一种“先进先出”的数据结构 其应用场景主要包含以下3个方面 应用解耦 系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。"><meta property="og:type" content="article"><meta property="og:image" content="https://github.com/lyf110/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-04-06T10:52:35.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="一、RocketMQ入门第一天"><meta property="article:author" content="liuyangfang"><meta property="article:tag" content="中间件"><meta property="article:tag" content="mq"><meta property="article:tag" content="阿里"><meta property="article:tag" content="RocketMQ"><meta property="article:published_time" content="2023-04-06T09:49:10.000Z"><meta property="article:modified_time" content="2023-04-06T10:52:35.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"一、RocketMQ入门第一天","image":["https://github.com/lyf110/"],"datePublished":"2023-04-06T09:49:10.000Z","dateModified":"2023-04-06T10:52:35.000Z","author":[{"@type":"Person","name":"liuyangfang","link":"https://github.com/lyf110"}]}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><link rel="icon" href="/favicon.ico"><title>一、RocketMQ入门第一天 | lyf blog</title><meta name="description" content="1. MQ介绍 1.1 为什么要用MQ 消息队列是一种“先进先出”的数据结构 其应用场景主要包含以下3个方面 应用解耦 系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-d27d5514.css" as="style"><link rel="stylesheet" href="/assets/style-d27d5514.css">
    <link rel="modulepreload" href="/assets/app-ce1c9f9d.js"><link rel="modulepreload" href="/assets/framework-7a1bedf3.js"><link rel="modulepreload" href="/assets/RocketMQ-01.html-ae6033cc.js"><link rel="modulepreload" href="/assets/RocketMQ角色-af9c6e95.js"><link rel="modulepreload" href="/assets/RocketMQ-01.html-d508c009.js"><link rel="prefetch" href="/assets/blog.html-2201ce83.js" as="script"><link rel="prefetch" href="/assets/index.html-8d072788.js" as="script"><link rel="prefetch" href="/assets/tools.html-7a68a8b6.js" as="script"><link rel="prefetch" href="/assets/Nacos源码分析.html-c966ca07.js" as="script"><link rel="prefetch" href="/assets/Sentinel源码分析.html-cb76e968.js" as="script"><link rel="prefetch" href="/assets/微服务常见面试题.html-ce1f705b.js" as="script"><link rel="prefetch" href="/assets/Java基础.html-4d071ff3.js" as="script"><link rel="prefetch" href="/assets/项目场景题收集.html-b126d705.js" as="script"><link rel="prefetch" href="/assets/项目工具类收集.html-374221e5.js" as="script"><link rel="prefetch" href="/assets/Windows杀进程资料.html-50d2cb36.js" as="script"><link rel="prefetch" href="/assets/recursion.html-aaea187f.js" as="script"><link rel="prefetch" href="/assets/Ffmpeg使用说明.html-0afcf120.js" as="script"><link rel="prefetch" href="/assets/Centos7常见问题记录.html-50305cea.js" as="script"><link rel="prefetch" href="/assets/Centos7新机开荒.html-1d547664.js" as="script"><link rel="prefetch" href="/assets/Https加密原理.html-9975080f.js" as="script"><link rel="prefetch" href="/assets/MVCC个人理解.html-d38548e4.js" as="script"><link rel="prefetch" href="/assets/MySQL安装教程.html-bcc88bcd.js" as="script"><link rel="prefetch" href="/assets/数据库死锁.html-bd1ffe92.js" as="script"><link rel="prefetch" href="/assets/集合常用面试题.html-7d8a7a20.js" as="script"><link rel="prefetch" href="/assets/让线程顺序运行的11种方法.html-94ada2cb.js" as="script"><link rel="prefetch" href="/assets/1 怎么解决Java8 stream操作toMap的key重复问题.html-3aaa77a1.js" as="script"><link rel="prefetch" href="/assets/JDK8新特性.html-41c37b1d.js" as="script"><link rel="prefetch" href="/assets/01.Spring的生命周期.html-82b742c3.js" as="script"><link rel="prefetch" href="/assets/02.SpringBoot配置项目支持多数据库.html-99d1c7ec.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-e3f9ac59.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（一）.html-517a8d25.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（二）.html-3864efce.js" as="script"><link rel="prefetch" href="/assets/Lucene入门.html-21dc4d90.js" as="script"><link rel="prefetch" href="/assets/01.Nacos 配置中心.html-c9924931.js" as="script"><link rel="prefetch" href="/assets/02.Nacos 服务发现.html-d70a62ff.js" as="script"><link rel="prefetch" href="/assets/03.Nacos 服务发现源码分析.html-0c3a1085.js" as="script"><link rel="prefetch" href="/assets/04.Nacos 配置中心源码解读.html-aaa71697.js" as="script"><link rel="prefetch" href="/assets/Seata Saga模式.html-69ab419b.js" as="script"><link rel="prefetch" href="/assets/seata的部署和集成.html-03cbaae8.js" as="script"><link rel="prefetch" href="/assets/分布式事务Seata.html-1d95d13a.js" as="script"><link rel="prefetch" href="/assets/微服务保护.html-4e05d279.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇01.html-abc40c0c.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html-1477a9c7.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（一）.html-f3ae588c.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（二）.html-88b3a79c.js" as="script"><link rel="prefetch" href="/assets/index.html-75e12137.js" as="script"><link rel="prefetch" href="/assets/index.html-60bc8b80.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-01.html-a2785680.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-02.html-71d373f7.js" as="script"><link rel="prefetch" href="/assets/jquery3基础.html-f79e962a.js" as="script"><link rel="prefetch" href="/assets/jquery3高级.html-16c8a378.js" as="script"><link rel="prefetch" href="/assets/Vue.html-3a1fcb70.js" as="script"><link rel="prefetch" href="/assets/day01-MyBatis2.0.html-3304763a.js" as="script"><link rel="prefetch" href="/assets/day02-MyBatis2.0.html-b4ee9b29.js" as="script"><link rel="prefetch" href="/assets/day03-MyBatis2.0.html-4b846c80.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第一天.html-be8b137a.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第二天.html-40502c55.js" as="script"><link rel="prefetch" href="/assets/MyBatisPlus.html-c22e9ab3.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-06ec4dd9.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第一天2.0.html-cd8d7b4c.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第三天2.0.html-49d529d9.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第二天2.0.html-06437a70.js" as="script"><link rel="prefetch" href="/assets/Centos7安装Docker.html-c80d0c4a.js" as="script"><link rel="prefetch" href="/assets/Docker-2022-实用篇.html-8e663b09.js" as="script"><link rel="prefetch" href="/assets/docker-linux-安装.html-352c65fc.js" as="script"><link rel="prefetch" href="/assets/docker-v1-01.html-84cf5e4c.js" as="script"><link rel="prefetch" href="/assets/docker-v2-01.html-dbcc5af0.js" as="script"><link rel="prefetch" href="/assets/docker-v2-02.html-ef421f81.js" as="script"><link rel="prefetch" href="/assets/Docker常见问题记录.html-c6edb416.js" as="script"><link rel="prefetch" href="/assets/Idea设置大全.html-889b47aa.js" as="script"><link rel="prefetch" href="/assets/Maven高级2.0.html-21969b52.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎01.html-c4022f7a.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎02.html-75a9fe2b.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎03.html-41d1edd3.js" as="script"><link rel="prefetch" href="/assets/笔记.html-02870b4f.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-基础篇.html-7d214fae.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html-8154931f.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-02.html-93769297.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-03.html-ba5030ab.js" as="script"><link rel="prefetch" href="/assets/Redis7-基础篇.html-abf4fa2c.js" as="script"><link rel="prefetch" href="/assets/Redis7-高级篇.html-21797812.js" as="script"><link rel="prefetch" href="/assets/01.Redis-入门篇.html-fee26d4e.js" as="script"><link rel="prefetch" href="/assets/02.Redis-实战篇.html-f7acc947.js" as="script"><link rel="prefetch" href="/assets/03.Redis高级篇-分布式缓存.html-76e9b26a.js" as="script"><link rel="prefetch" href="/assets/04.Redis高级篇-多级缓存.html-bcdd7b8e.js" as="script"><link rel="prefetch" href="/assets/05.Redis高级篇-最佳实践.html-a3596a14.js" as="script"><link rel="prefetch" href="/assets/06.Redis-原理篇.html-89041de5.js" as="script"><link rel="prefetch" href="/assets/Netty01-nio.html-c2c0c2b3.js" as="script"><link rel="prefetch" href="/assets/Netty02-入门.html-f8e46de2.js" as="script"><link rel="prefetch" href="/assets/Netty03-进阶.html-81035463.js" as="script"><link rel="prefetch" href="/assets/Netty04-优化与源码.html-c62d7bfb.js" as="script"><link rel="prefetch" href="/assets/01_Spring高级49讲-容器与bean.html-b4d28370.js" as="script"><link rel="prefetch" href="/assets/02_Spring-高级49讲-AOP.html-4d843985.js" as="script"><link rel="prefetch" href="/assets/03_Spring高级49讲-WEB.html-3923a48f.js" as="script"><link rel="prefetch" href="/assets/04_Spring高级49讲-SpringBoot相关.html-cc486ffd.js" as="script"><link rel="prefetch" href="/assets/05_Spring高级49讲-其它.html-688750b1.js" as="script"><link rel="prefetch" href="/assets/spring5第一天2.0.html-3bbb3b20.js" as="script"><link rel="prefetch" href="/assets/spring5第三天2.0.html-d0e7b718.js" as="script"><link rel="prefetch" href="/assets/spring5第二天2.0.html-852d21b0.js" as="script"><link rel="prefetch" href="/assets/spring5第四天2.0.html-574ea6cd.js" as="script"><link rel="prefetch" href="/assets/附录(切入点表达式规则).html-6b379561.js" as="script"><link rel="prefetch" href="/assets/01 MySQL概述.html-0b690b14.js" as="script"><link rel="prefetch" href="/assets/02 MySQL分类.html-6da54caa.js" as="script"><link rel="prefetch" href="/assets/03 MySQL函数.html-6eb99aab.js" as="script"><link rel="prefetch" href="/assets/04 MySQL约束.html-bb8d06a3.js" as="script"><link rel="prefetch" href="/assets/05 MySQL多表查询.html-b659c5a8.js" as="script"><link rel="prefetch" href="/assets/06 MySQL事务.html-de4cafd5.js" as="script"><link rel="prefetch" href="/assets/1 日志.html-7090f26b.js" as="script"><link rel="prefetch" href="/assets/2 主从复制.html-70191fcb.js" as="script"><link rel="prefetch" href="/assets/3 分库分表.html-6b15979f.js" as="script"><link rel="prefetch" href="/assets/4 MyCat.html-c51d4a92.js" as="script"><link rel="prefetch" href="/assets/5 读写分离.html-1c664b36.js" as="script"><link rel="prefetch" href="/assets/01 存储引擎.html-004d3e77.js" as="script"><link rel="prefetch" href="/assets/02 索引.html-158cf356.js" as="script"><link rel="prefetch" href="/assets/03 MySQL优化.html-309c1e2c.js" as="script"><link rel="prefetch" href="/assets/04 视图、存储过程、触发器.html-9cb5724a.js" as="script"><link rel="prefetch" href="/assets/05 锁.html-5a31056b.js" as="script"><link rel="prefetch" href="/assets/06 事务.html-f1508041.js" as="script"><link rel="prefetch" href="/assets/07 MySQL管理.html-5100e2f5.js" as="script"><link rel="prefetch" href="/assets/404.html-e8024d5f.js" as="script"><link rel="prefetch" href="/assets/index.html-7a44b2a7.js" as="script"><link rel="prefetch" href="/assets/index.html-c2d8257e.js" as="script"><link rel="prefetch" href="/assets/index.html-65508815.js" as="script"><link rel="prefetch" href="/assets/index.html-6098d3bf.js" as="script"><link rel="prefetch" href="/assets/index.html-40fa5774.js" as="script"><link rel="prefetch" href="/assets/index.html-b0e0e9af.js" as="script"><link rel="prefetch" href="/assets/index.html-dec21a8c.js" as="script"><link rel="prefetch" href="/assets/index.html-0d941bbd.js" as="script"><link rel="prefetch" href="/assets/index.html-1fd0c226.js" as="script"><link rel="prefetch" href="/assets/index.html-855e15e1.js" as="script"><link rel="prefetch" href="/assets/index.html-7ac25e09.js" as="script"><link rel="prefetch" href="/assets/index.html-0b9dd320.js" as="script"><link rel="prefetch" href="/assets/index.html-ef577929.js" as="script"><link rel="prefetch" href="/assets/index.html-c92a16c7.js" as="script"><link rel="prefetch" href="/assets/index.html-594fde9b.js" as="script"><link rel="prefetch" href="/assets/index.html-b173eeb5.js" as="script"><link rel="prefetch" href="/assets/index.html-699799d5.js" as="script"><link rel="prefetch" href="/assets/index.html-1655480d.js" as="script"><link rel="prefetch" href="/assets/index.html-2762eb7c.js" as="script"><link rel="prefetch" href="/assets/index.html-ec29bb00.js" as="script"><link rel="prefetch" href="/assets/index.html-8ad46694.js" as="script"><link rel="prefetch" href="/assets/index.html-c52aef96.js" as="script"><link rel="prefetch" href="/assets/index.html-45e4c836.js" as="script"><link rel="prefetch" href="/assets/index.html-4d5c4585.js" as="script"><link rel="prefetch" href="/assets/index.html-9c53d089.js" as="script"><link rel="prefetch" href="/assets/index.html-389340d2.js" as="script"><link rel="prefetch" href="/assets/index.html-560a0e47.js" as="script"><link rel="prefetch" href="/assets/index.html-b44ae0e9.js" as="script"><link rel="prefetch" href="/assets/index.html-318d5d38.js" as="script"><link rel="prefetch" href="/assets/index.html-64cb38e1.js" as="script"><link rel="prefetch" href="/assets/index.html-847cae86.js" as="script"><link rel="prefetch" href="/assets/index.html-6f14aea0.js" as="script"><link rel="prefetch" href="/assets/index.html-ee52fb03.js" as="script"><link rel="prefetch" href="/assets/index.html-bf49ba50.js" as="script"><link rel="prefetch" href="/assets/index.html-50a493c3.js" as="script"><link rel="prefetch" href="/assets/index.html-6055cf89.js" as="script"><link rel="prefetch" href="/assets/index.html-53af87b9.js" as="script"><link rel="prefetch" href="/assets/index.html-6a6f9ab6.js" as="script"><link rel="prefetch" href="/assets/index.html-16fbeec9.js" as="script"><link rel="prefetch" href="/assets/index.html-71ea77cb.js" as="script"><link rel="prefetch" href="/assets/index.html-1b4b4894.js" as="script"><link rel="prefetch" href="/assets/index.html-19212216.js" as="script"><link rel="prefetch" href="/assets/index.html-0f0e002d.js" as="script"><link rel="prefetch" href="/assets/index.html-48300a13.js" as="script"><link rel="prefetch" href="/assets/index.html-cf862da0.js" as="script"><link rel="prefetch" href="/assets/index.html-6430fb47.js" as="script"><link rel="prefetch" href="/assets/index.html-9d582514.js" as="script"><link rel="prefetch" href="/assets/index.html-628f91d7.js" as="script"><link rel="prefetch" href="/assets/index.html-7fe46b97.js" as="script"><link rel="prefetch" href="/assets/index.html-64530238.js" as="script"><link rel="prefetch" href="/assets/index.html-4a2282ff.js" as="script"><link rel="prefetch" href="/assets/index.html-8ed873a1.js" as="script"><link rel="prefetch" href="/assets/index.html-6a4b2e99.js" as="script"><link rel="prefetch" href="/assets/index.html-6a6ef731.js" as="script"><link rel="prefetch" href="/assets/index.html-324d994a.js" as="script"><link rel="prefetch" href="/assets/index.html-b2cb6c65.js" as="script"><link rel="prefetch" href="/assets/index.html-6bc6c9a9.js" as="script"><link rel="prefetch" href="/assets/index.html-008a4009.js" as="script"><link rel="prefetch" href="/assets/index.html-1b44bc96.js" as="script"><link rel="prefetch" href="/assets/index.html-9ab99db5.js" as="script"><link rel="prefetch" href="/assets/index.html-d4efb8cb.js" as="script"><link rel="prefetch" href="/assets/index.html-c6071e2e.js" as="script"><link rel="prefetch" href="/assets/index.html-176e959a.js" as="script"><link rel="prefetch" href="/assets/index.html-ac83c7ec.js" as="script"><link rel="prefetch" href="/assets/index.html-aa6b1351.js" as="script"><link rel="prefetch" href="/assets/index.html-0de2b419.js" as="script"><link rel="prefetch" href="/assets/index.html-0afc07ab.js" as="script"><link rel="prefetch" href="/assets/index.html-ad5d3e88.js" as="script"><link rel="prefetch" href="/assets/index.html-b07d9651.js" as="script"><link rel="prefetch" href="/assets/index.html-81e4ee0f.js" as="script"><link rel="prefetch" href="/assets/index.html-7532eea1.js" as="script"><link rel="prefetch" href="/assets/index.html-073dd832.js" as="script"><link rel="prefetch" href="/assets/index.html-882202ca.js" as="script"><link rel="prefetch" href="/assets/index.html-2d34f4d1.js" as="script"><link rel="prefetch" href="/assets/index.html-fbd58386.js" as="script"><link rel="prefetch" href="/assets/index.html-4f426bef.js" as="script"><link rel="prefetch" href="/assets/index.html-836760e1.js" as="script"><link rel="prefetch" href="/assets/index.html-c08dc8a7.js" as="script"><link rel="prefetch" href="/assets/index.html-8f7a11c1.js" as="script"><link rel="prefetch" href="/assets/index.html-009beb66.js" as="script"><link rel="prefetch" href="/assets/index.html-596458cb.js" as="script"><link rel="prefetch" href="/assets/index.html-731d7a71.js" as="script"><link rel="prefetch" href="/assets/index.html-6b063fb8.js" as="script"><link rel="prefetch" href="/assets/index.html-6a725f4a.js" as="script"><link rel="prefetch" href="/assets/index.html-6318f350.js" as="script"><link rel="prefetch" href="/assets/index.html-2c82ecd3.js" as="script"><link rel="prefetch" href="/assets/index.html-8f79dde7.js" as="script"><link rel="prefetch" href="/assets/index.html-f236d0e0.js" as="script"><link rel="prefetch" href="/assets/index.html-c5daf2c8.js" as="script"><link rel="prefetch" href="/assets/index.html-d874ae66.js" as="script"><link rel="prefetch" href="/assets/index.html-87cebe18.js" as="script"><link rel="prefetch" href="/assets/index.html-6b3fd793.js" as="script"><link rel="prefetch" href="/assets/index.html-6deee822.js" as="script"><link rel="prefetch" href="/assets/index.html-05193bc8.js" as="script"><link rel="prefetch" href="/assets/index.html-e974589b.js" as="script"><link rel="prefetch" href="/assets/index.html-75026ff4.js" as="script"><link rel="prefetch" href="/assets/index.html-783a5464.js" as="script"><link rel="prefetch" href="/assets/index.html-7c9910fa.js" as="script"><link rel="prefetch" href="/assets/index.html-9558b866.js" as="script"><link rel="prefetch" href="/assets/index.html-3a1d239a.js" as="script"><link rel="prefetch" href="/assets/index.html-2bc20db6.js" as="script"><link rel="prefetch" href="/assets/index.html-b4fe098b.js" as="script"><link rel="prefetch" href="/assets/index.html-d6eb0416.js" as="script"><link rel="prefetch" href="/assets/index.html-26b4945c.js" as="script"><link rel="prefetch" href="/assets/index.html-972d27e2.js" as="script"><link rel="prefetch" href="/assets/index.html-45a75503.js" as="script"><link rel="prefetch" href="/assets/index.html-292cd72f.js" as="script"><link rel="prefetch" href="/assets/index.html-814f5a55.js" as="script"><link rel="prefetch" href="/assets/index.html-4a7a603b.js" as="script"><link rel="prefetch" href="/assets/index.html-dca1adb2.js" as="script"><link rel="prefetch" href="/assets/index.html-186c0015.js" as="script"><link rel="prefetch" href="/assets/index.html-5ac45bfb.js" as="script"><link rel="prefetch" href="/assets/index.html-22140455.js" as="script"><link rel="prefetch" href="/assets/index.html-90d6f8e8.js" as="script"><link rel="prefetch" href="/assets/index.html-836ad4a2.js" as="script"><link rel="prefetch" href="/assets/index.html-682ed04d.js" as="script"><link rel="prefetch" href="/assets/index.html-04b334d0.js" as="script"><link rel="prefetch" href="/assets/index.html-2d1843c0.js" as="script"><link rel="prefetch" href="/assets/index.html-bc626a2e.js" as="script"><link rel="prefetch" href="/assets/index.html-95eff682.js" as="script"><link rel="prefetch" href="/assets/index.html-f73b8490.js" as="script"><link rel="prefetch" href="/assets/index.html-e4987e48.js" as="script"><link rel="prefetch" href="/assets/index.html-d14bdbaf.js" as="script"><link rel="prefetch" href="/assets/index.html-b7033790.js" as="script"><link rel="prefetch" href="/assets/index.html-35697d1e.js" as="script"><link rel="prefetch" href="/assets/index.html-3536a38f.js" as="script"><link rel="prefetch" href="/assets/index.html-f1bff1b1.js" as="script"><link rel="prefetch" href="/assets/index.html-b8fd9817.js" as="script"><link rel="prefetch" href="/assets/index.html-76dd3c70.js" as="script"><link rel="prefetch" href="/assets/index.html-c8c18739.js" as="script"><link rel="prefetch" href="/assets/index.html-5f4cac44.js" as="script"><link rel="prefetch" href="/assets/index.html-4f4cf926.js" as="script"><link rel="prefetch" href="/assets/index.html-2a5bd6b7.js" as="script"><link rel="prefetch" href="/assets/index.html-e577154f.js" as="script"><link rel="prefetch" href="/assets/index.html-8e3e2285.js" as="script"><link rel="prefetch" href="/assets/index.html-630afe2c.js" as="script"><link rel="prefetch" href="/assets/index.html-a07984f0.js" as="script"><link rel="prefetch" href="/assets/index.html-d2b3eefa.js" as="script"><link rel="prefetch" href="/assets/index.html-a283e669.js" as="script"><link rel="prefetch" href="/assets/index.html-863ebb9a.js" as="script"><link rel="prefetch" href="/assets/index.html-c5200fcc.js" as="script"><link rel="prefetch" href="/assets/index.html-37abb384.js" as="script"><link rel="prefetch" href="/assets/index.html-5bb88a8b.js" as="script"><link rel="prefetch" href="/assets/index.html-cf5e90da.js" as="script"><link rel="prefetch" href="/assets/index.html-66ae7fe6.js" as="script"><link rel="prefetch" href="/assets/index.html-64a7a5b8.js" as="script"><link rel="prefetch" href="/assets/index.html-acfe5990.js" as="script"><link rel="prefetch" href="/assets/index.html-4581b87a.js" as="script"><link rel="prefetch" href="/assets/index.html-f8c14602.js" as="script"><link rel="prefetch" href="/assets/index.html-bab644c6.js" as="script"><link rel="prefetch" href="/assets/index.html-fa5e8210.js" as="script"><link rel="prefetch" href="/assets/index.html-fc759619.js" as="script"><link rel="prefetch" href="/assets/index.html-b213330d.js" as="script"><link rel="prefetch" href="/assets/index.html-30a0af87.js" as="script"><link rel="prefetch" href="/assets/index.html-75978b77.js" as="script"><link rel="prefetch" href="/assets/index.html-32b3491e.js" as="script"><link rel="prefetch" href="/assets/index.html-59ca2443.js" as="script"><link rel="prefetch" href="/assets/index.html-987846fb.js" as="script"><link rel="prefetch" href="/assets/index.html-91c690fb.js" as="script"><link rel="prefetch" href="/assets/index.html-a48a655a.js" as="script"><link rel="prefetch" href="/assets/index.html-a09b7784.js" as="script"><link rel="prefetch" href="/assets/index.html-5dc03253.js" as="script"><link rel="prefetch" href="/assets/index.html-96a908d1.js" as="script"><link rel="prefetch" href="/assets/index.html-3cbc5bc6.js" as="script"><link rel="prefetch" href="/assets/index.html-fa31a2a5.js" as="script"><link rel="prefetch" href="/assets/index.html-ff486795.js" as="script"><link rel="prefetch" href="/assets/index.html-a96a13d7.js" as="script"><link rel="prefetch" href="/assets/index.html-4d2cd113.js" as="script"><link rel="prefetch" href="/assets/index.html-f0159889.js" as="script"><link rel="prefetch" href="/assets/index.html-4dcdb9d1.js" as="script"><link rel="prefetch" href="/assets/index.html-c69083f8.js" as="script"><link rel="prefetch" href="/assets/index.html-22711a96.js" as="script"><link rel="prefetch" href="/assets/index.html-7cb5872a.js" as="script"><link rel="prefetch" href="/assets/index.html-4b1b84c4.js" as="script"><link rel="prefetch" href="/assets/index.html-e0c16ff1.js" as="script"><link rel="prefetch" href="/assets/index.html-d6a7d13c.js" as="script"><link rel="prefetch" href="/assets/index.html-f8f6dab2.js" as="script"><link rel="prefetch" href="/assets/index.html-def8fbc2.js" as="script"><link rel="prefetch" href="/assets/index.html-d14b4dc3.js" as="script"><link rel="prefetch" href="/assets/index.html-96bf54f0.js" as="script"><link rel="prefetch" href="/assets/index.html-4623fd45.js" as="script"><link rel="prefetch" href="/assets/index.html-c6acd68f.js" as="script"><link rel="prefetch" href="/assets/index.html-13d0fca8.js" as="script"><link rel="prefetch" href="/assets/index.html-cf8783af.js" as="script"><link rel="prefetch" href="/assets/index.html-d0d2e2c8.js" as="script"><link rel="prefetch" href="/assets/index.html-b4233e90.js" as="script"><link rel="prefetch" href="/assets/index.html-7a9335c5.js" as="script"><link rel="prefetch" href="/assets/index.html-af838e02.js" as="script"><link rel="prefetch" href="/assets/index.html-0d8bd120.js" as="script"><link rel="prefetch" href="/assets/index.html-1920f004.js" as="script"><link rel="prefetch" href="/assets/index.html-8913b174.js" as="script"><link rel="prefetch" href="/assets/index.html-be90f6f8.js" as="script"><link rel="prefetch" href="/assets/index.html-0e622f96.js" as="script"><link rel="prefetch" href="/assets/index.html-fa6fabc2.js" as="script"><link rel="prefetch" href="/assets/index.html-a46aedeb.js" as="script"><link rel="prefetch" href="/assets/index.html-94e85ee7.js" as="script"><link rel="prefetch" href="/assets/index.html-9cd8ff9c.js" as="script"><link rel="prefetch" href="/assets/index.html-8fe6afa8.js" as="script"><link rel="prefetch" href="/assets/index.html-e5bff0ee.js" as="script"><link rel="prefetch" href="/assets/index.html-a353acff.js" as="script"><link rel="prefetch" href="/assets/index.html-2c42df8e.js" as="script"><link rel="prefetch" href="/assets/index.html-e685b064.js" as="script"><link rel="prefetch" href="/assets/index.html-bce73b8c.js" as="script"><link rel="prefetch" href="/assets/index.html-8f755b24.js" as="script"><link rel="prefetch" href="/assets/index.html-161cfd2f.js" as="script"><link rel="prefetch" href="/assets/index.html-fd5532f1.js" as="script"><link rel="prefetch" href="/assets/index.html-00ea4678.js" as="script"><link rel="prefetch" href="/assets/index.html-17f494f6.js" as="script"><link rel="prefetch" href="/assets/index.html-7373dd2a.js" as="script"><link rel="prefetch" href="/assets/index.html-43aa72ea.js" as="script"><link rel="prefetch" href="/assets/index.html-2058319a.js" as="script"><link rel="prefetch" href="/assets/index.html-fac8fcf7.js" as="script"><link rel="prefetch" href="/assets/index.html-d02462a2.js" as="script"><link rel="prefetch" href="/assets/index.html-449b35c2.js" as="script"><link rel="prefetch" href="/assets/index.html-a307c69e.js" as="script"><link rel="prefetch" href="/assets/index.html-570872b6.js" as="script"><link rel="prefetch" href="/assets/index.html-c68d03c2.js" as="script"><link rel="prefetch" href="/assets/index.html-449e078a.js" as="script"><link rel="prefetch" href="/assets/index.html-afd5c28a.js" as="script"><link rel="prefetch" href="/assets/index.html-e3247093.js" as="script"><link rel="prefetch" href="/assets/index.html-88f31470.js" as="script"><link rel="prefetch" href="/assets/index.html-f11f5ab3.js" as="script"><link rel="prefetch" href="/assets/index.html-495bbda2.js" as="script"><link rel="prefetch" href="/assets/index.html-495e82b8.js" as="script"><link rel="prefetch" href="/assets/index.html-e2a05d80.js" as="script"><link rel="prefetch" href="/assets/index.html-04c52082.js" as="script"><link rel="prefetch" href="/assets/index.html-98ef8437.js" as="script"><link rel="prefetch" href="/assets/index.html-8ed3ec08.js" as="script"><link rel="prefetch" href="/assets/index.html-df67c987.js" as="script"><link rel="prefetch" href="/assets/index.html-d74e9cca.js" as="script"><link rel="prefetch" href="/assets/index.html-604e4b37.js" as="script"><link rel="prefetch" href="/assets/index.html-27b368b9.js" as="script"><link rel="prefetch" href="/assets/index.html-d18e302c.js" as="script"><link rel="prefetch" href="/assets/index.html-bbbdb95c.js" as="script"><link rel="prefetch" href="/assets/index.html-8d837281.js" as="script"><link rel="prefetch" href="/assets/index.html-443f213b.js" as="script"><link rel="prefetch" href="/assets/index.html-bddace15.js" as="script"><link rel="prefetch" href="/assets/index.html-eeaf07d7.js" as="script"><link rel="prefetch" href="/assets/index.html-fb476a0b.js" as="script"><link rel="prefetch" href="/assets/index.html-22496847.js" as="script"><link rel="prefetch" href="/assets/index.html-a0dc2f84.js" as="script"><link rel="prefetch" href="/assets/index.html-a2b63b69.js" as="script"><link rel="prefetch" href="/assets/index.html-51e5fc87.js" as="script"><link rel="prefetch" href="/assets/index.html-3cf0055d.js" as="script"><link rel="prefetch" href="/assets/index.html-f8a15ad4.js" as="script"><link rel="prefetch" href="/assets/index.html-046be050.js" as="script"><link rel="prefetch" href="/assets/index.html-af00f73a.js" as="script"><link rel="prefetch" href="/assets/index.html-795a06ba.js" as="script"><link rel="prefetch" href="/assets/index.html-34474ed7.js" as="script"><link rel="prefetch" href="/assets/index.html-29bc36ba.js" as="script"><link rel="prefetch" href="/assets/index.html-e2093c5c.js" as="script"><link rel="prefetch" href="/assets/index.html-64f9f9af.js" as="script"><link rel="prefetch" href="/assets/index.html-5b6ffa97.js" as="script"><link rel="prefetch" href="/assets/index.html-4b0b03e5.js" as="script"><link rel="prefetch" href="/assets/index.html-d26a06ca.js" as="script"><link rel="prefetch" href="/assets/index.html-385c8d17.js" as="script"><link rel="prefetch" href="/assets/index.html-3585ea6d.js" as="script"><link rel="prefetch" href="/assets/index.html-8ce02fdd.js" as="script"><link rel="prefetch" href="/assets/index.html-b0dd5205.js" as="script"><link rel="prefetch" href="/assets/index.html-87812d39.js" as="script"><link rel="prefetch" href="/assets/index.html-a341b7d2.js" as="script"><link rel="prefetch" href="/assets/index.html-ea37f5f0.js" as="script"><link rel="prefetch" href="/assets/index.html-47e60921.js" as="script"><link rel="prefetch" href="/assets/index.html-588274db.js" as="script"><link rel="prefetch" href="/assets/index.html-b39803ba.js" as="script"><link rel="prefetch" href="/assets/index.html-e1a6ceda.js" as="script"><link rel="prefetch" href="/assets/index.html-33126c06.js" as="script"><link rel="prefetch" href="/assets/index.html-9fbc9f60.js" as="script"><link rel="prefetch" href="/assets/index.html-f49e0f1f.js" as="script"><link rel="prefetch" href="/assets/index.html-62ea0783.js" as="script"><link rel="prefetch" href="/assets/index.html-215050dd.js" as="script"><link rel="prefetch" href="/assets/index.html-f180485a.js" as="script"><link rel="prefetch" href="/assets/index.html-a229b664.js" as="script"><link rel="prefetch" href="/assets/index.html-39f1d0e6.js" as="script"><link rel="prefetch" href="/assets/index.html-6c6c4f7b.js" as="script"><link rel="prefetch" href="/assets/index.html-6f796429.js" as="script"><link rel="prefetch" href="/assets/index.html-ace93632.js" as="script"><link rel="prefetch" href="/assets/index.html-bd528ceb.js" as="script"><link rel="prefetch" href="/assets/index.html-79697d77.js" as="script"><link rel="prefetch" href="/assets/blog.html-e26d2f74.js" as="script"><link rel="prefetch" href="/assets/index.html-fd6b6e17.js" as="script"><link rel="prefetch" href="/assets/tools.html-20002948.js" as="script"><link rel="prefetch" href="/assets/Nacos源码分析.html-d6fdaaf1.js" as="script"><link rel="prefetch" href="/assets/Sentinel源码分析.html-d2287ccb.js" as="script"><link rel="prefetch" href="/assets/微服务常见面试题.html-1e73cd58.js" as="script"><link rel="prefetch" href="/assets/Java基础.html-35f10bcd.js" as="script"><link rel="prefetch" href="/assets/项目场景题收集.html-ea4afb56.js" as="script"><link rel="prefetch" href="/assets/项目工具类收集.html-21d9556d.js" as="script"><link rel="prefetch" href="/assets/Windows杀进程资料.html-9819abe6.js" as="script"><link rel="prefetch" href="/assets/recursion.html-fe8f3ab8.js" as="script"><link rel="prefetch" href="/assets/Ffmpeg使用说明.html-3202d822.js" as="script"><link rel="prefetch" href="/assets/Centos7常见问题记录.html-664f70ec.js" as="script"><link rel="prefetch" href="/assets/Centos7新机开荒.html-56a34cbc.js" as="script"><link rel="prefetch" href="/assets/Https加密原理.html-530bf4a2.js" as="script"><link rel="prefetch" href="/assets/MVCC个人理解.html-19303061.js" as="script"><link rel="prefetch" href="/assets/MySQL安装教程.html-4ac08eba.js" as="script"><link rel="prefetch" href="/assets/数据库死锁.html-14699953.js" as="script"><link rel="prefetch" href="/assets/集合常用面试题.html-3838c6f8.js" as="script"><link rel="prefetch" href="/assets/让线程顺序运行的11种方法.html-69a593ab.js" as="script"><link rel="prefetch" href="/assets/1 怎么解决Java8 stream操作toMap的key重复问题.html-9b989647.js" as="script"><link rel="prefetch" href="/assets/JDK8新特性.html-d2dca101.js" as="script"><link rel="prefetch" href="/assets/01.Spring的生命周期.html-bdf2fa10.js" as="script"><link rel="prefetch" href="/assets/02.SpringBoot配置项目支持多数据库.html-8c7f8f5f.js" as="script"><link rel="prefetch" href="/assets/Dubbo.html-6926f9ce.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（一）.html-186cfa5d.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch（二）.html-5d0b63d9.js" as="script"><link rel="prefetch" href="/assets/Lucene入门.html-66934155.js" as="script"><link rel="prefetch" href="/assets/01.Nacos 配置中心.html-ffe7cb10.js" as="script"><link rel="prefetch" href="/assets/02.Nacos 服务发现.html-095a3cf6.js" as="script"><link rel="prefetch" href="/assets/03.Nacos 服务发现源码分析.html-e6d72f35.js" as="script"><link rel="prefetch" href="/assets/04.Nacos 配置中心源码解读.html-1bfd9a91.js" as="script"><link rel="prefetch" href="/assets/Seata Saga模式.html-d12dbb58.js" as="script"><link rel="prefetch" href="/assets/seata的部署和集成.html-510062eb.js" as="script"><link rel="prefetch" href="/assets/分布式事务Seata.html-df276017.js" as="script"><link rel="prefetch" href="/assets/微服务保护.html-8bd69f02.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇01.html-a403d3d9.js" as="script"><link rel="prefetch" href="/assets/SpringCloud实用篇02.html-c1775312.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（一）.html-80914200.js" as="script"><link rel="prefetch" href="/assets/SpringCloud（二）.html-bd628246.js" as="script"><link rel="prefetch" href="/assets/index.html-c20667f2.js" as="script"><link rel="prefetch" href="/assets/index.html-b96ce9f5.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-01.html-b9707bd3.js" as="script"><link rel="prefetch" href="/assets/Bootstrap-02.html-5753da76.js" as="script"><link rel="prefetch" href="/assets/jquery3基础.html-e61e55ff.js" as="script"><link rel="prefetch" href="/assets/jquery3高级.html-7233e5b1.js" as="script"><link rel="prefetch" href="/assets/Vue.html-aa40e4e1.js" as="script"><link rel="prefetch" href="/assets/day01-MyBatis2.0.html-70b66e9f.js" as="script"><link rel="prefetch" href="/assets/day02-MyBatis2.0.html-a0600ff5.js" as="script"><link rel="prefetch" href="/assets/day03-MyBatis2.0.html-405934aa.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第一天.html-5ec27f34.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus入门第二天.html-2cfdbd6c.js" as="script"><link rel="prefetch" href="/assets/MyBatisPlus.html-4f50b2bd.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-6f028257.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第一天2.0.html-8f47de3a.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第三天2.0.html-350cde97.js" as="script"><link rel="prefetch" href="/assets/spring5mvc第二天2.0.html-f11314f2.js" as="script"><link rel="prefetch" href="/assets/Centos7安装Docker.html-6bbed298.js" as="script"><link rel="prefetch" href="/assets/Docker-2022-实用篇.html-be709570.js" as="script"><link rel="prefetch" href="/assets/docker-linux-安装.html-fbaf2888.js" as="script"><link rel="prefetch" href="/assets/docker-v1-01.html-cc6a55d6.js" as="script"><link rel="prefetch" href="/assets/docker-v2-01.html-18d1fa9c.js" as="script"><link rel="prefetch" href="/assets/docker-v2-02.html-482752a2.js" as="script"><link rel="prefetch" href="/assets/Docker常见问题记录.html-32bdf784.js" as="script"><link rel="prefetch" href="/assets/Idea设置大全.html-d8ca44f2.js" as="script"><link rel="prefetch" href="/assets/Maven高级2.0.html-b920004c.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎01.html-8d07aace.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎02.html-015e45fb.js" as="script"><link rel="prefetch" href="/assets/分布式搜索引擎03.html-e6fa14aa.js" as="script"><link rel="prefetch" href="/assets/笔记.html-de1b0c1a.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-基础篇.html-82ac6c52.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ-高级篇.html-a84b2740.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-02.html-6cf8ef73.js" as="script"><link rel="prefetch" href="/assets/RocketMQ-03.html-2368fa69.js" as="script"><link rel="prefetch" href="/assets/Redis7-基础篇.html-bca5478d.js" as="script"><link rel="prefetch" href="/assets/Redis7-高级篇.html-ea95fa20.js" as="script"><link rel="prefetch" href="/assets/01.Redis-入门篇.html-afefeee6.js" as="script"><link rel="prefetch" href="/assets/02.Redis-实战篇.html-3ea39e8f.js" as="script"><link rel="prefetch" href="/assets/03.Redis高级篇-分布式缓存.html-9099efe9.js" as="script"><link rel="prefetch" href="/assets/04.Redis高级篇-多级缓存.html-b54340ce.js" as="script"><link rel="prefetch" href="/assets/05.Redis高级篇-最佳实践.html-d8403c64.js" as="script"><link rel="prefetch" href="/assets/06.Redis-原理篇.html-941249e2.js" as="script"><link rel="prefetch" href="/assets/Netty01-nio.html-ab0c7763.js" as="script"><link rel="prefetch" href="/assets/Netty02-入门.html-6593e0a6.js" as="script"><link rel="prefetch" href="/assets/Netty03-进阶.html-0205b7ff.js" as="script"><link rel="prefetch" href="/assets/Netty04-优化与源码.html-62693707.js" as="script"><link rel="prefetch" href="/assets/01_Spring高级49讲-容器与bean.html-1d699162.js" as="script"><link rel="prefetch" href="/assets/02_Spring-高级49讲-AOP.html-226ea5bd.js" as="script"><link rel="prefetch" href="/assets/03_Spring高级49讲-WEB.html-ab8a0b03.js" as="script"><link rel="prefetch" href="/assets/04_Spring高级49讲-SpringBoot相关.html-c4b479b5.js" as="script"><link rel="prefetch" href="/assets/05_Spring高级49讲-其它.html-f9c0100a.js" as="script"><link rel="prefetch" href="/assets/spring5第一天2.0.html-87193f71.js" as="script"><link rel="prefetch" href="/assets/spring5第三天2.0.html-d276ab2a.js" as="script"><link rel="prefetch" href="/assets/spring5第二天2.0.html-2ab4ac0e.js" as="script"><link rel="prefetch" href="/assets/spring5第四天2.0.html-fcd15071.js" as="script"><link rel="prefetch" href="/assets/附录(切入点表达式规则).html-84ac6132.js" as="script"><link rel="prefetch" href="/assets/01 MySQL概述.html-0944da32.js" as="script"><link rel="prefetch" href="/assets/02 MySQL分类.html-4a2e1e9e.js" as="script"><link rel="prefetch" href="/assets/03 MySQL函数.html-39913d78.js" as="script"><link rel="prefetch" href="/assets/04 MySQL约束.html-e47d7da5.js" as="script"><link rel="prefetch" href="/assets/05 MySQL多表查询.html-ed185e28.js" as="script"><link rel="prefetch" href="/assets/06 MySQL事务.html-89fe5b14.js" as="script"><link rel="prefetch" href="/assets/1 日志.html-23fd341a.js" as="script"><link rel="prefetch" href="/assets/2 主从复制.html-6b120434.js" as="script"><link rel="prefetch" href="/assets/3 分库分表.html-656aba35.js" as="script"><link rel="prefetch" href="/assets/4 MyCat.html-14f4a94c.js" as="script"><link rel="prefetch" href="/assets/5 读写分离.html-880adbdc.js" as="script"><link rel="prefetch" href="/assets/01 存储引擎.html-c84fc572.js" as="script"><link rel="prefetch" href="/assets/02 索引.html-903a4a70.js" as="script"><link rel="prefetch" href="/assets/03 MySQL优化.html-38069a4b.js" as="script"><link rel="prefetch" href="/assets/04 视图、存储过程、触发器.html-4d4e637f.js" as="script"><link rel="prefetch" href="/assets/05 锁.html-b67d4730.js" as="script"><link rel="prefetch" href="/assets/06 事务.html-db0ea5aa.js" as="script"><link rel="prefetch" href="/assets/07 MySQL管理.html-61647636.js" as="script"><link rel="prefetch" href="/assets/404.html-9ce6035f.js" as="script"><link rel="prefetch" href="/assets/index.html-edc2dc59.js" as="script"><link rel="prefetch" href="/assets/index.html-9116c59a.js" as="script"><link rel="prefetch" href="/assets/index.html-0d2323fb.js" as="script"><link rel="prefetch" href="/assets/index.html-4b245915.js" as="script"><link rel="prefetch" href="/assets/index.html-440d0e06.js" as="script"><link rel="prefetch" href="/assets/index.html-34a10f0e.js" as="script"><link rel="prefetch" href="/assets/index.html-53b4af91.js" as="script"><link rel="prefetch" href="/assets/index.html-9b27f7a8.js" as="script"><link rel="prefetch" href="/assets/index.html-5d8af298.js" as="script"><link rel="prefetch" href="/assets/index.html-54ead1d7.js" as="script"><link rel="prefetch" href="/assets/index.html-5657c874.js" as="script"><link rel="prefetch" href="/assets/index.html-dec257cd.js" as="script"><link rel="prefetch" href="/assets/index.html-c31939e3.js" as="script"><link rel="prefetch" href="/assets/index.html-fdb41de0.js" as="script"><link rel="prefetch" href="/assets/index.html-0fa41148.js" as="script"><link rel="prefetch" href="/assets/index.html-130cdf9d.js" as="script"><link rel="prefetch" href="/assets/index.html-2c1e2619.js" as="script"><link rel="prefetch" href="/assets/index.html-831a99e2.js" as="script"><link rel="prefetch" href="/assets/index.html-05b5a391.js" as="script"><link rel="prefetch" href="/assets/index.html-71d04d87.js" as="script"><link rel="prefetch" href="/assets/index.html-28b06130.js" as="script"><link rel="prefetch" href="/assets/index.html-8b26e3ce.js" as="script"><link rel="prefetch" href="/assets/index.html-e852d1ca.js" as="script"><link rel="prefetch" href="/assets/index.html-67281c06.js" as="script"><link rel="prefetch" href="/assets/index.html-beb3bbb9.js" as="script"><link rel="prefetch" href="/assets/index.html-643d07f7.js" as="script"><link rel="prefetch" href="/assets/index.html-d3c84f7b.js" as="script"><link rel="prefetch" href="/assets/index.html-65ff1556.js" as="script"><link rel="prefetch" href="/assets/index.html-073d3efa.js" as="script"><link rel="prefetch" href="/assets/index.html-c0f54aad.js" as="script"><link rel="prefetch" href="/assets/index.html-9d41bb35.js" as="script"><link rel="prefetch" href="/assets/index.html-0722552c.js" as="script"><link rel="prefetch" href="/assets/index.html-cdfc810e.js" as="script"><link rel="prefetch" href="/assets/index.html-829d9a99.js" as="script"><link rel="prefetch" href="/assets/index.html-68e653d1.js" as="script"><link rel="prefetch" href="/assets/index.html-d3ca87d0.js" as="script"><link rel="prefetch" href="/assets/index.html-21113088.js" as="script"><link rel="prefetch" href="/assets/index.html-f2dc98b6.js" as="script"><link rel="prefetch" href="/assets/index.html-c08e6e79.js" as="script"><link rel="prefetch" href="/assets/index.html-a9d0c576.js" as="script"><link rel="prefetch" href="/assets/index.html-9340a959.js" as="script"><link rel="prefetch" href="/assets/index.html-97b05f7c.js" as="script"><link rel="prefetch" href="/assets/index.html-d51283ea.js" as="script"><link rel="prefetch" href="/assets/index.html-2dfa31a3.js" as="script"><link rel="prefetch" href="/assets/index.html-e99ad80c.js" as="script"><link rel="prefetch" href="/assets/index.html-96ae5cf3.js" as="script"><link rel="prefetch" href="/assets/index.html-46ce0f81.js" as="script"><link rel="prefetch" href="/assets/index.html-18534302.js" as="script"><link rel="prefetch" href="/assets/index.html-37cde32f.js" as="script"><link rel="prefetch" href="/assets/index.html-7ef7fa65.js" as="script"><link rel="prefetch" href="/assets/index.html-9be5c047.js" as="script"><link rel="prefetch" href="/assets/index.html-ae6ebd1d.js" as="script"><link rel="prefetch" href="/assets/index.html-5e2d2f35.js" as="script"><link rel="prefetch" href="/assets/index.html-3eddff2b.js" as="script"><link rel="prefetch" href="/assets/index.html-305fd60c.js" as="script"><link rel="prefetch" href="/assets/index.html-d719f8cc.js" as="script"><link rel="prefetch" href="/assets/index.html-5db6e423.js" as="script"><link rel="prefetch" href="/assets/index.html-3e4777da.js" as="script"><link rel="prefetch" href="/assets/index.html-369157dc.js" as="script"><link rel="prefetch" href="/assets/index.html-e409087c.js" as="script"><link rel="prefetch" href="/assets/index.html-09cda23c.js" as="script"><link rel="prefetch" href="/assets/index.html-106f6811.js" as="script"><link rel="prefetch" href="/assets/index.html-98c4bea3.js" as="script"><link rel="prefetch" href="/assets/index.html-5cf4c095.js" as="script"><link rel="prefetch" href="/assets/index.html-1f716d16.js" as="script"><link rel="prefetch" href="/assets/index.html-a987020d.js" as="script"><link rel="prefetch" href="/assets/index.html-8126c1a2.js" as="script"><link rel="prefetch" href="/assets/index.html-8c3e30e8.js" as="script"><link rel="prefetch" href="/assets/index.html-da916e51.js" as="script"><link rel="prefetch" href="/assets/index.html-ab3bd1d4.js" as="script"><link rel="prefetch" href="/assets/index.html-bcd36fbb.js" as="script"><link rel="prefetch" href="/assets/index.html-4eacff6a.js" as="script"><link rel="prefetch" href="/assets/index.html-0249a9ea.js" as="script"><link rel="prefetch" href="/assets/index.html-62180d80.js" as="script"><link rel="prefetch" href="/assets/index.html-2f209424.js" as="script"><link rel="prefetch" href="/assets/index.html-7dd65cdb.js" as="script"><link rel="prefetch" href="/assets/index.html-6fe7b0ab.js" as="script"><link rel="prefetch" href="/assets/index.html-ca3c7c38.js" as="script"><link rel="prefetch" href="/assets/index.html-f411bcdb.js" as="script"><link rel="prefetch" href="/assets/index.html-b2faa453.js" as="script"><link rel="prefetch" href="/assets/index.html-008c1cf8.js" as="script"><link rel="prefetch" href="/assets/index.html-7afcbd9f.js" as="script"><link rel="prefetch" href="/assets/index.html-50f37300.js" as="script"><link rel="prefetch" href="/assets/index.html-37b44e66.js" as="script"><link rel="prefetch" href="/assets/index.html-68c76944.js" as="script"><link rel="prefetch" href="/assets/index.html-c93cca86.js" as="script"><link rel="prefetch" href="/assets/index.html-e5858afe.js" as="script"><link rel="prefetch" href="/assets/index.html-3518fdfd.js" as="script"><link rel="prefetch" href="/assets/index.html-e2a451fc.js" as="script"><link rel="prefetch" href="/assets/index.html-f1a7b93e.js" as="script"><link rel="prefetch" href="/assets/index.html-41610527.js" as="script"><link rel="prefetch" href="/assets/index.html-e5df0240.js" as="script"><link rel="prefetch" href="/assets/index.html-e7254ae2.js" as="script"><link rel="prefetch" href="/assets/index.html-c0ce3f73.js" as="script"><link rel="prefetch" href="/assets/index.html-1949aea7.js" as="script"><link rel="prefetch" href="/assets/index.html-850f6c04.js" as="script"><link rel="prefetch" href="/assets/index.html-5c6b2784.js" as="script"><link rel="prefetch" href="/assets/index.html-8c9ee548.js" as="script"><link rel="prefetch" href="/assets/index.html-95e7a1dc.js" as="script"><link rel="prefetch" href="/assets/index.html-278bf2fc.js" as="script"><link rel="prefetch" href="/assets/index.html-c1f8610f.js" as="script"><link rel="prefetch" href="/assets/index.html-3058e711.js" as="script"><link rel="prefetch" href="/assets/index.html-5a5c39c2.js" as="script"><link rel="prefetch" href="/assets/index.html-b4cc63c2.js" as="script"><link rel="prefetch" href="/assets/index.html-703a5c52.js" as="script"><link rel="prefetch" href="/assets/index.html-f894906a.js" as="script"><link rel="prefetch" href="/assets/index.html-4c69d9ca.js" as="script"><link rel="prefetch" href="/assets/index.html-be6e95ed.js" as="script"><link rel="prefetch" href="/assets/index.html-44ce1d78.js" as="script"><link rel="prefetch" href="/assets/index.html-00e6b46c.js" as="script"><link rel="prefetch" href="/assets/index.html-dac7a817.js" as="script"><link rel="prefetch" href="/assets/index.html-ca920c59.js" as="script"><link rel="prefetch" href="/assets/index.html-bde7460a.js" as="script"><link rel="prefetch" href="/assets/index.html-540ae1e8.js" as="script"><link rel="prefetch" href="/assets/index.html-0421cb1b.js" as="script"><link rel="prefetch" href="/assets/index.html-23ac28de.js" as="script"><link rel="prefetch" href="/assets/index.html-7806bb80.js" as="script"><link rel="prefetch" href="/assets/index.html-346780bc.js" as="script"><link rel="prefetch" href="/assets/index.html-0e2519d5.js" as="script"><link rel="prefetch" href="/assets/index.html-83ed024f.js" as="script"><link rel="prefetch" href="/assets/index.html-0d3d5028.js" as="script"><link rel="prefetch" href="/assets/index.html-b7e57723.js" as="script"><link rel="prefetch" href="/assets/index.html-25266e9c.js" as="script"><link rel="prefetch" href="/assets/index.html-8afb1ced.js" as="script"><link rel="prefetch" href="/assets/index.html-82370b0e.js" as="script"><link rel="prefetch" href="/assets/index.html-ad5af630.js" as="script"><link rel="prefetch" href="/assets/index.html-e4069176.js" as="script"><link rel="prefetch" href="/assets/index.html-bb4326e1.js" as="script"><link rel="prefetch" href="/assets/index.html-61fbd7f4.js" as="script"><link rel="prefetch" href="/assets/index.html-514f599b.js" as="script"><link rel="prefetch" href="/assets/index.html-dcfe79d5.js" as="script"><link rel="prefetch" href="/assets/index.html-f07cf8de.js" as="script"><link rel="prefetch" href="/assets/index.html-8c86f39b.js" as="script"><link rel="prefetch" href="/assets/index.html-7130285f.js" as="script"><link rel="prefetch" href="/assets/index.html-43523e66.js" as="script"><link rel="prefetch" href="/assets/index.html-50e76aa8.js" as="script"><link rel="prefetch" href="/assets/index.html-b074a3c7.js" as="script"><link rel="prefetch" href="/assets/index.html-96c80d1f.js" as="script"><link rel="prefetch" href="/assets/index.html-fd25f505.js" as="script"><link rel="prefetch" href="/assets/index.html-3da0d2af.js" as="script"><link rel="prefetch" href="/assets/index.html-40fc8369.js" as="script"><link rel="prefetch" href="/assets/index.html-916ffa74.js" as="script"><link rel="prefetch" href="/assets/index.html-d6cb760a.js" as="script"><link rel="prefetch" href="/assets/index.html-cc74056f.js" as="script"><link rel="prefetch" href="/assets/index.html-641bee86.js" as="script"><link rel="prefetch" href="/assets/index.html-c3963412.js" as="script"><link rel="prefetch" href="/assets/index.html-a8c989e8.js" as="script"><link rel="prefetch" href="/assets/index.html-1561c2d3.js" as="script"><link rel="prefetch" href="/assets/index.html-de9f1668.js" as="script"><link rel="prefetch" href="/assets/index.html-c1464d19.js" as="script"><link rel="prefetch" href="/assets/index.html-649d8a69.js" as="script"><link rel="prefetch" href="/assets/index.html-1a1be84b.js" as="script"><link rel="prefetch" href="/assets/index.html-d79fa890.js" as="script"><link rel="prefetch" href="/assets/index.html-cd0ae63d.js" as="script"><link rel="prefetch" href="/assets/index.html-3d80e4da.js" as="script"><link rel="prefetch" href="/assets/index.html-e6fccf69.js" as="script"><link rel="prefetch" href="/assets/index.html-60d5ed56.js" as="script"><link rel="prefetch" href="/assets/index.html-e39069f9.js" as="script"><link rel="prefetch" href="/assets/index.html-fca63887.js" as="script"><link rel="prefetch" href="/assets/index.html-c2ac7638.js" as="script"><link rel="prefetch" href="/assets/index.html-9c8abbcf.js" as="script"><link rel="prefetch" href="/assets/index.html-03f9bcdd.js" as="script"><link rel="prefetch" href="/assets/index.html-87667979.js" as="script"><link rel="prefetch" href="/assets/index.html-89589837.js" as="script"><link rel="prefetch" href="/assets/index.html-4c5101ae.js" as="script"><link rel="prefetch" href="/assets/index.html-fa8973a0.js" as="script"><link rel="prefetch" href="/assets/index.html-b01e3719.js" as="script"><link rel="prefetch" href="/assets/index.html-60dfadf0.js" as="script"><link rel="prefetch" href="/assets/index.html-2b079c99.js" as="script"><link rel="prefetch" href="/assets/index.html-9806b030.js" as="script"><link rel="prefetch" href="/assets/index.html-85e67108.js" as="script"><link rel="prefetch" href="/assets/index.html-ec2bd4b7.js" as="script"><link rel="prefetch" href="/assets/index.html-525a5a63.js" as="script"><link rel="prefetch" href="/assets/index.html-ed56cb33.js" as="script"><link rel="prefetch" href="/assets/index.html-70d0f40d.js" as="script"><link rel="prefetch" href="/assets/index.html-33b02c89.js" as="script"><link rel="prefetch" href="/assets/index.html-cb0eaa79.js" as="script"><link rel="prefetch" href="/assets/index.html-c36d1d1e.js" as="script"><link rel="prefetch" href="/assets/index.html-1db6908d.js" as="script"><link rel="prefetch" href="/assets/index.html-a456ded8.js" as="script"><link rel="prefetch" href="/assets/index.html-3401eaa2.js" as="script"><link rel="prefetch" href="/assets/index.html-8310b5d8.js" as="script"><link rel="prefetch" href="/assets/index.html-455f5253.js" as="script"><link rel="prefetch" href="/assets/index.html-18be38b4.js" as="script"><link rel="prefetch" href="/assets/index.html-276e8b83.js" as="script"><link rel="prefetch" href="/assets/index.html-19091f42.js" as="script"><link rel="prefetch" href="/assets/index.html-288eec25.js" as="script"><link rel="prefetch" href="/assets/index.html-dd72154a.js" as="script"><link rel="prefetch" href="/assets/index.html-8cae6860.js" as="script"><link rel="prefetch" href="/assets/index.html-2d39d65b.js" as="script"><link rel="prefetch" href="/assets/index.html-7fb19805.js" as="script"><link rel="prefetch" href="/assets/index.html-a004db2e.js" as="script"><link rel="prefetch" href="/assets/index.html-b93c437a.js" as="script"><link rel="prefetch" href="/assets/index.html-40da67b5.js" as="script"><link rel="prefetch" href="/assets/index.html-039dae71.js" as="script"><link rel="prefetch" href="/assets/index.html-6a79a564.js" as="script"><link rel="prefetch" href="/assets/index.html-0b3ba0cc.js" as="script"><link rel="prefetch" href="/assets/index.html-24750256.js" as="script"><link rel="prefetch" href="/assets/index.html-156fe4c9.js" as="script"><link rel="prefetch" href="/assets/index.html-95f53fb6.js" as="script"><link rel="prefetch" href="/assets/index.html-0798b1a4.js" as="script"><link rel="prefetch" href="/assets/index.html-b9aa8d5a.js" as="script"><link rel="prefetch" href="/assets/index.html-148b0ad0.js" as="script"><link rel="prefetch" href="/assets/index.html-0fb8d31f.js" as="script"><link rel="prefetch" href="/assets/index.html-2cc7165e.js" as="script"><link rel="prefetch" href="/assets/index.html-37ca61ac.js" as="script"><link rel="prefetch" href="/assets/index.html-d8af78fc.js" as="script"><link rel="prefetch" href="/assets/index.html-cfb0e06b.js" as="script"><link rel="prefetch" href="/assets/index.html-b0649cd7.js" as="script"><link rel="prefetch" href="/assets/index.html-41263b46.js" as="script"><link rel="prefetch" href="/assets/index.html-f14826f9.js" as="script"><link rel="prefetch" href="/assets/index.html-6f421c05.js" as="script"><link rel="prefetch" href="/assets/index.html-e83cbf28.js" as="script"><link rel="prefetch" href="/assets/index.html-bec752f9.js" as="script"><link rel="prefetch" href="/assets/index.html-bf37c968.js" as="script"><link rel="prefetch" href="/assets/index.html-4e505d87.js" as="script"><link rel="prefetch" href="/assets/index.html-29393571.js" as="script"><link rel="prefetch" href="/assets/index.html-7bf64aa1.js" as="script"><link rel="prefetch" href="/assets/index.html-fa6fc714.js" as="script"><link rel="prefetch" href="/assets/index.html-b3975f45.js" as="script"><link rel="prefetch" href="/assets/index.html-00b030d3.js" as="script"><link rel="prefetch" href="/assets/index.html-254dcddd.js" as="script"><link rel="prefetch" href="/assets/index.html-cf0741cf.js" as="script"><link rel="prefetch" href="/assets/index.html-7d40580b.js" as="script"><link rel="prefetch" href="/assets/index.html-3e5fc941.js" as="script"><link rel="prefetch" href="/assets/index.html-a48e6a82.js" as="script"><link rel="prefetch" href="/assets/index.html-14734ff4.js" as="script"><link rel="prefetch" href="/assets/index.html-5049b0d8.js" as="script"><link rel="prefetch" href="/assets/index.html-cf8c46a4.js" as="script"><link rel="prefetch" href="/assets/index.html-d2183a50.js" as="script"><link rel="prefetch" href="/assets/index.html-f8079c99.js" as="script"><link rel="prefetch" href="/assets/index.html-1908d737.js" as="script"><link rel="prefetch" href="/assets/index.html-39948514.js" as="script"><link rel="prefetch" href="/assets/index.html-9b34f4a0.js" as="script"><link rel="prefetch" href="/assets/index.html-42ec3d71.js" as="script"><link rel="prefetch" href="/assets/index.html-6f413df4.js" as="script"><link rel="prefetch" href="/assets/index.html-bf917f41.js" as="script"><link rel="prefetch" href="/assets/index.html-572f0cee.js" as="script"><link rel="prefetch" href="/assets/index.html-a1ccfba6.js" as="script"><link rel="prefetch" href="/assets/index.html-817f111d.js" as="script"><link rel="prefetch" href="/assets/index.html-dbd8c5a0.js" as="script"><link rel="prefetch" href="/assets/index.html-a372f6af.js" as="script"><link rel="prefetch" href="/assets/index.html-4405e52a.js" as="script"><link rel="prefetch" href="/assets/index.html-c04efe27.js" as="script"><link rel="prefetch" href="/assets/index.html-741c5a50.js" as="script"><link rel="prefetch" href="/assets/index.html-a1af8aaa.js" as="script"><link rel="prefetch" href="/assets/index.html-2732d0ce.js" as="script"><link rel="prefetch" href="/assets/index.html-86d609f8.js" as="script"><link rel="prefetch" href="/assets/index.html-a24a6a21.js" as="script"><link rel="prefetch" href="/assets/index.html-1e98eb58.js" as="script"><link rel="prefetch" href="/assets/index.html-06ad273e.js" as="script"><link rel="prefetch" href="/assets/index.html-568474e5.js" as="script"><link rel="prefetch" href="/assets/index.html-9aaa40d3.js" as="script"><link rel="prefetch" href="/assets/index.html-a80cfae2.js" as="script"><link rel="prefetch" href="/assets/index.html-481c5485.js" as="script"><link rel="prefetch" href="/assets/index.html-137740f8.js" as="script"><link rel="prefetch" href="/assets/index.html-278c91a2.js" as="script"><link rel="prefetch" href="/assets/index.html-c7f4da3c.js" as="script"><link rel="prefetch" href="/assets/index.html-4a47b895.js" as="script"><link rel="prefetch" href="/assets/index.html-65fbe5e1.js" as="script"><link rel="prefetch" href="/assets/index.html-51ca91ff.js" as="script"><link rel="prefetch" href="/assets/index.html-6af160e1.js" as="script"><link rel="prefetch" href="/assets/index.html-ecd410c1.js" as="script"><link rel="prefetch" href="/assets/index.html-59f7b1b9.js" as="script"><link rel="prefetch" href="/assets/index.html-f928645d.js" as="script"><link rel="prefetch" href="/assets/index.html-6b5250be.js" as="script"><link rel="prefetch" href="/assets/index.html-4eae8352.js" as="script"><link rel="prefetch" href="/assets/index.html-76df2f6e.js" as="script"><link rel="prefetch" href="/assets/index.html-939434ac.js" as="script"><link rel="prefetch" href="/assets/index.html-0abeb98c.js" as="script"><link rel="prefetch" href="/assets/index.html-368acc29.js" as="script"><link rel="prefetch" href="/assets/index.html-28e8f4b6.js" as="script"><link rel="prefetch" href="/assets/index.html-a22f1f38.js" as="script"><link rel="prefetch" href="/assets/index.html-5fb9c629.js" as="script"><link rel="prefetch" href="/assets/index.html-804ca543.js" as="script"><link rel="prefetch" href="/assets/index.html-c809681d.js" as="script"><link rel="prefetch" href="/assets/index.html-799a42de.js" as="script"><link rel="prefetch" href="/assets/index.html-9a1b51ae.js" as="script"><link rel="prefetch" href="/assets/index.html-b5b7e4b8.js" as="script"><link rel="prefetch" href="/assets/giscus-16d370b8.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-b03bef79.js" as="script"><link rel="prefetch" href="/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-95585b94.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-a50d0e7d.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-36cd6c3c.js" as="script"><link rel="prefetch" href="/assets/SearchResult-0d18d72e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="lyf blog"><!----><span class="site-name hide-in-pad">lyf blog</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="笔记"><span class="title"><span class="font-icon icon iconfont icon-note" style=""></span>笔记</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/notes/java/" class="nav-link" aria-label="JavaSE"><span class="font-icon icon iconfont icon-java" style=""></span>JavaSE<!----></a></li><li class="dropdown-item"><a href="/notes/front/" class="nav-link" aria-label="前端"><span class="font-icon icon iconfont icon-vue" style=""></span>前端<!----></a></li><li class="dropdown-item"><a href="/notes/ssm/" class="nav-link" aria-label="SSM"><span class="font-icon icon iconfont icon-java" style=""></span>SSM<!----></a></li><li class="dropdown-item"><a href="/notes/database/" class="nav-link" aria-label="数据库"><span class="font-icon icon iconfont icon-mysql" style=""></span>数据库<!----></a></li><li class="dropdown-item"><a href="/notes/cloud/" class="nav-link active" aria-label="微服务"><span class="font-icon icon iconfont icon-java" style=""></span>微服务<!----></a></li><li class="dropdown-item"><a href="/notes/tools/" class="nav-link" aria-label="开发工具"><span class="font-icon icon iconfont icon-tool" style=""></span>开发工具<!----></a></li><li class="dropdown-item"><a href="/notes/project/" class="nav-link" aria-label="项目"><span class="font-icon icon iconfont icon-workingDirectory" style=""></span>项目<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="面试指南"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>面试指南</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/interview/javabase/" class="nav-link" aria-label="Java基础"><span class="font-icon icon iconfont icon-java" style=""></span>Java基础<!----></a></li><li class="dropdown-item"><a href="/interview/database/" class="nav-link" aria-label="数据库"><span class="font-icon icon iconfont icon-mysql" style=""></span>数据库<!----></a></li><li class="dropdown-item"><a href="/interview/ssm/" class="nav-link" aria-label="常用框架"><span class="font-icon icon iconfont icon-java" style=""></span>常用框架<!----></a></li><li class="dropdown-item"><a href="/interview/cloud/" class="nav-link" aria-label="微服务"><span class="font-icon icon iconfont icon-es6" style=""></span>微服务<!----></a></li><li class="dropdown-item"><a href="/interview/computer/" class="nav-link" aria-label="计算机原理"><span class="font-icon icon iconfont icon-computer" style=""></span>计算机原理<!----></a></li><li class="dropdown-item"><a href="/interview/windows/" class="nav-link" aria-label="windows相关"><span class="font-icon icon iconfont icon-computer" style=""></span>windows相关<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="其它"><span class="title"><span class="font-icon icon iconfont icon-others" style=""></span>其它</span><span class="arrow"></span><ul class="nav-dropdown"></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/label/" class="nav-link" aria-label="书签"><span class="font-icon icon iconfont icon-tool" style=""></span>书签<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/lyf110/lyf110.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">Java基础</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-vue" style=""></span><span class="title">前端</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">常用框架</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-mysql" style=""></span><span class="title">数据库</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-tool" style=""></span><span class="title">开发工具</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-es6" style=""></span><span class="title">微服务</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Dubbo</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Elasticsearch</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><span class="title">Mq</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Rabbitmq</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><span class="title">Rocketmq</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="一、RocketMQ入门第一天"><!---->一、RocketMQ入门第一天<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_1-1-为什么要用mq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1 为什么要用MQ"><!---->1.1 为什么要用MQ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_1-2-mq的优点和缺点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2 MQ的优点和缺点"><!---->1.2 MQ的优点和缺点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_1-3-各种mq产品的比较" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.3 各种MQ产品的比较"><!---->1.3 各种MQ产品的比较<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-1-准备工作" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1 准备工作"><!---->2.1 准备工作<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-1-1-下载rocketmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.1 下载RocketMQ"><!---->2.1.1 下载RocketMQ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-2-环境要求" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.2 环境要求"><!---->2.2.2 环境要求<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-安装rocketmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2 安装RocketMQ"><!---->2.2 安装RocketMQ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-1-安装步骤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.1 安装步骤"><!---->2.2.1 安装步骤<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-2-目录介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.2 目录介绍"><!---->2.2.2 目录介绍<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-3-启动rocketmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 启动RocketMQ"><!---->2.3 启动RocketMQ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-4-测试rocketmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4 测试RocketMQ"><!---->2.4 测试RocketMQ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-4-1-发送消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.1 发送消息"><!---->2.4.1 发送消息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-4-2-接收消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.2 接收消息"><!---->2.4.2 接收消息<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-5-关闭rocketmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.5 关闭RocketMQ"><!---->2.5 关闭RocketMQ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-6-基于docker方式搭建rocketmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.6 基于Docker方式搭建RocketMQ"><!---->2.6 基于Docker方式搭建RocketMQ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-6-1-去https-hub-docker-com-搜索docker镜像" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.6.1 去https://hub.docker.com 搜索Docker镜像"><!---->2.6.1 去https://hub.docker.com 搜索Docker镜像<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-6-2-基于5-1-0版本构建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.6.2 基于5.1.0版本构建"><!---->2.6.2 基于5.1.0版本构建<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3、创建topic" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3、创建Topic"><!---->3、创建Topic<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4、安装rocketmq-console" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4、安装rocketmq-console"><!---->4、安装rocketmq-console<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-1-各角色介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 各角色介绍"><!---->3.1 各角色介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-2-集群搭建方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2 集群搭建方式"><!---->3.2 集群搭建方式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-2-1-集群特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2.1 集群特点"><!---->3.2.1 集群特点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-2-3-集群模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2.3 集群模式"><!---->3.2.3 集群模式<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-双主双从集群搭建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3 双主双从集群搭建"><!---->3.3 双主双从集群搭建<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-1-总体架构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.1 总体架构"><!---->3.3.1 总体架构<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-2-集群工作流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.2 集群工作流程"><!---->3.3.2 集群工作流程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-3-服务器环境" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.3 服务器环境"><!---->3.3.3 服务器环境<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-4-host添加信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.4 Host添加信息"><!---->3.3.4 Host添加信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-5-防火墙配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.5 防火墙配置"><!---->3.3.5 防火墙配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-6-环境变量配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.6 环境变量配置"><!---->3.3.6 环境变量配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-7-创建消息存储路径" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.7 创建消息存储路径"><!---->3.3.7 创建消息存储路径<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-8-broker配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.8 broker配置文件"><!---->3.3.8 broker配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-9-修改启动脚本文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.9 修改启动脚本文件"><!---->3.3.9 修改启动脚本文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-10-服务启动" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.10 服务启动"><!---->3.3.10 服务启动<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-11-查看进程状态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.11 查看进程状态"><!---->3.3.11 查看进程状态<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-12-查看日志" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3.12 查看日志"><!---->3.3.12 查看日志<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-mqadmin管理工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4 mqadmin管理工具"><!---->3.4 mqadmin管理工具<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-1-使用方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4.1 使用方式"><!---->3.4.1 使用方式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-2-命令介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4.2 命令介绍"><!---->3.4.2 命令介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-3-注意事项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4.3 注意事项"><!---->3.4.3 注意事项<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-5-集群监控平台搭建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.5 集群监控平台搭建"><!---->3.5 集群监控平台搭建<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-5-1-概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.5.1 概述"><!---->3.5.1 概述<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-5-2-下载并编译打包" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.5.2 下载并编译打包"><!---->3.5.2 下载并编译打包<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-基本样例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1 基本样例"><!---->4.1 基本样例<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-1-消息发送" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1.1 消息发送"><!---->4.1.1 消息发送<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-2-消费消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1.2 消费消息"><!---->4.1.2 消费消息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-3-工具类的封装" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1.3 工具类的封装"><!---->4.1.3 工具类的封装<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-2-顺序消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.2 顺序消息"><!---->4.2 顺序消息<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-2-1-顺序消息生产" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.2.1 顺序消息生产"><!---->4.2.1 顺序消息生产<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-2-2-顺序消费消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.2.2 顺序消费消息"><!---->4.2.2 顺序消费消息<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-延时消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.3 延时消息"><!---->4.3 延时消息<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-1-启动消息消费者" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.3.1 启动消息消费者"><!---->4.3.1 启动消息消费者<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-2-发送延时消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.3.2 发送延时消息"><!---->4.3.2 发送延时消息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-3-验证" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.3.3 验证"><!---->4.3.3 验证<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-4-使用限制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.3.4 使用限制"><!---->4.3.4 使用限制<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-4-批量消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.4 批量消息"><!---->4.4 批量消息<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-4-1-发送批量消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.4.1 发送批量消息"><!---->4.4.1 发送批量消息<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-过滤消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.5 过滤消息"><!---->4.5 过滤消息<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-1-sql基本语法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.5.1 SQL基本语法"><!---->4.5.1 SQL基本语法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-2-消息生产者" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.5.2 消息生产者"><!---->4.5.2 消息生产者<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-3-消息消费者" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.5.3 消息消费者"><!---->4.5.3 消息消费者<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-事务消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.6 事务消息"><!---->4.6 事务消息<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-1-流程分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.6.1 流程分析"><!---->4.6.1 流程分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-2-发送事务消息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.6.2 发送事务消息"><!---->4.6.2 发送事务消息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-3-使用限制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.6.3 使用限制"><!---->4.6.3 使用限制<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/notes/cloud/mq/rocketmq/RocketMQ-02.html" class="nav-link sidebar-link sidebar-page" aria-label="二、RocketMQ入门第二天"><!---->二、RocketMQ入门第二天<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/notes/cloud/mq/rocketmq/RocketMQ-03.html" class="nav-link sidebar-link sidebar-page" aria-label="三、RocketMQ入门第三天"><!---->三、RocketMQ入门第三天<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Nacos</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Seata</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Sentinel</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Springcloud</span><span class="arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->一、RocketMQ入门第一天</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">liuyangfang</span></span><span property="author" content="liuyangfang"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-06T09:49:10.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 72 分钟</span><meta property="timeRequired" content="PT72M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category5 clickable" role="navigation">中间件</span><span class="page-category-item category0 clickable" role="navigation">mq</span><span class="page-category-item category0 clickable" role="navigation">阿里</span><span class="page-category-item category0 clickable" role="navigation">RocketMQ</span><meta property="articleSection" content="中间件,mq,阿里,RocketMQ"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag5 clickable" role="navigation">中间件</span><span class="page-tag-item tag0 clickable" role="navigation">mq</span><span class="page-tag-item tag0 clickable" role="navigation">阿里</span><span class="page-tag-item tag0 clickable" role="navigation">RocketMQ</span><meta property="keywords" content="中间件,mq,阿里,RocketMQ"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_1-1-为什么要用mq" class="router-link-active router-link-exact-active toc-link level2">1.1 为什么要用MQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_1-2-mq的优点和缺点" class="router-link-active router-link-exact-active toc-link level2">1.2 MQ的优点和缺点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_1-3-各种mq产品的比较" class="router-link-active router-link-exact-active toc-link level2">1.3 各种MQ产品的比较</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-1-准备工作" class="router-link-active router-link-exact-active toc-link level2">2.1 准备工作</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-1-1-下载rocketmq" class="router-link-active router-link-exact-active toc-link level3">2.1.1 下载RocketMQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-2-环境要求" class="router-link-active router-link-exact-active toc-link level3">2.2.2 环境要求</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-安装rocketmq" class="router-link-active router-link-exact-active toc-link level2">2.2 安装RocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-1-安装步骤" class="router-link-active router-link-exact-active toc-link level3">2.2.1 安装步骤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-2-2-目录介绍" class="router-link-active router-link-exact-active toc-link level3">2.2.2 目录介绍</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-3-启动rocketmq" class="router-link-active router-link-exact-active toc-link level2">2.3 启动RocketMQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-4-测试rocketmq" class="router-link-active router-link-exact-active toc-link level2">2.4 测试RocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-4-1-发送消息" class="router-link-active router-link-exact-active toc-link level3">2.4.1 发送消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-4-2-接收消息" class="router-link-active router-link-exact-active toc-link level3">2.4.2 接收消息</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-5-关闭rocketmq" class="router-link-active router-link-exact-active toc-link level2">2.5 关闭RocketMQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-6-基于docker方式搭建rocketmq" class="router-link-active router-link-exact-active toc-link level2">2.6 基于Docker方式搭建RocketMQ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-6-1-去https-hub-docker-com-搜索docker镜像" class="router-link-active router-link-exact-active toc-link level3">2.6.1 去https://hub.docker.com 搜索Docker镜像</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_2-6-2-基于5-1-0版本构建" class="router-link-active router-link-exact-active toc-link level3">2.6.2 基于5.1.0版本构建</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3、创建topic" class="router-link-active router-link-exact-active toc-link level3">3、创建Topic</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4、安装rocketmq-console" class="router-link-active router-link-exact-active toc-link level3">4、安装rocketmq-console</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-1-各角色介绍" class="router-link-active router-link-exact-active toc-link level2">3.1 各角色介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-2-集群搭建方式" class="router-link-active router-link-exact-active toc-link level2">3.2 集群搭建方式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-2-1-集群特点" class="router-link-active router-link-exact-active toc-link level3">3.2.1 集群特点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-2-3-集群模式" class="router-link-active router-link-exact-active toc-link level3">3.2.3 集群模式</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-双主双从集群搭建" class="router-link-active router-link-exact-active toc-link level2">3.3 双主双从集群搭建</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-1-总体架构" class="router-link-active router-link-exact-active toc-link level3">3.3.1 总体架构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-2-集群工作流程" class="router-link-active router-link-exact-active toc-link level3">3.3.2 集群工作流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-3-服务器环境" class="router-link-active router-link-exact-active toc-link level3">3.3.3 服务器环境</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-4-host添加信息" class="router-link-active router-link-exact-active toc-link level3">3.3.4 Host添加信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-5-防火墙配置" class="router-link-active router-link-exact-active toc-link level3">3.3.5 防火墙配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-6-环境变量配置" class="router-link-active router-link-exact-active toc-link level3">3.3.6 环境变量配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-7-创建消息存储路径" class="router-link-active router-link-exact-active toc-link level3">3.3.7 创建消息存储路径</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-8-broker配置文件" class="router-link-active router-link-exact-active toc-link level3">3.3.8 broker配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-9-修改启动脚本文件" class="router-link-active router-link-exact-active toc-link level3">3.3.9 修改启动脚本文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-10-服务启动" class="router-link-active router-link-exact-active toc-link level3">3.3.10 服务启动</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-11-查看进程状态" class="router-link-active router-link-exact-active toc-link level3">3.3.11 查看进程状态</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-3-12-查看日志" class="router-link-active router-link-exact-active toc-link level3">3.3.12 查看日志</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-mqadmin管理工具" class="router-link-active router-link-exact-active toc-link level2">3.4 mqadmin管理工具</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-1-使用方式" class="router-link-active router-link-exact-active toc-link level3">3.4.1 使用方式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-2-命令介绍" class="router-link-active router-link-exact-active toc-link level3">3.4.2 命令介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-4-3-注意事项" class="router-link-active router-link-exact-active toc-link level3">3.4.3 注意事项</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-5-集群监控平台搭建" class="router-link-active router-link-exact-active toc-link level2">3.5 集群监控平台搭建</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-5-1-概述" class="router-link-active router-link-exact-active toc-link level3">3.5.1 概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_3-5-2-下载并编译打包" class="router-link-active router-link-exact-active toc-link level3">3.5.2 下载并编译打包</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-基本样例" class="router-link-active router-link-exact-active toc-link level2">4.1 基本样例</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-1-消息发送" class="router-link-active router-link-exact-active toc-link level3">4.1.1 消息发送</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-2-消费消息" class="router-link-active router-link-exact-active toc-link level3">4.1.2 消费消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-1-3-工具类的封装" class="router-link-active router-link-exact-active toc-link level3">4.1.3 工具类的封装</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-2-顺序消息" class="router-link-active router-link-exact-active toc-link level2">4.2 顺序消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-2-1-顺序消息生产" class="router-link-active router-link-exact-active toc-link level3">4.2.1 顺序消息生产</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-2-2-顺序消费消息" class="router-link-active router-link-exact-active toc-link level3">4.2.2 顺序消费消息</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-延时消息" class="router-link-active router-link-exact-active toc-link level2">4.3 延时消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-1-启动消息消费者" class="router-link-active router-link-exact-active toc-link level3">4.3.1 启动消息消费者</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-2-发送延时消息" class="router-link-active router-link-exact-active toc-link level3">4.3.2 发送延时消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-3-验证" class="router-link-active router-link-exact-active toc-link level3">4.3.3 验证</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-3-4-使用限制" class="router-link-active router-link-exact-active toc-link level3">4.3.4 使用限制</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-4-批量消息" class="router-link-active router-link-exact-active toc-link level2">4.4 批量消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-4-1-发送批量消息" class="router-link-active router-link-exact-active toc-link level3">4.4.1 发送批量消息</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-过滤消息" class="router-link-active router-link-exact-active toc-link level2">4.5 过滤消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-1-sql基本语法" class="router-link-active router-link-exact-active toc-link level3">4.5.1 SQL基本语法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-2-消息生产者" class="router-link-active router-link-exact-active toc-link level3">4.5.2 消息生产者</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-5-3-消息消费者" class="router-link-active router-link-exact-active toc-link level3">4.5.3 消息消费者</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-事务消息" class="router-link-active router-link-exact-active toc-link level2">4.6 事务消息</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-1-流程分析" class="router-link-active router-link-exact-active toc-link level3">4.6.1 流程分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-2-发送事务消息" class="router-link-active router-link-exact-active toc-link level3">4.6.2 发送事务消息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/notes/cloud/mq/rocketmq/RocketMQ-01.html#_4-6-3-使用限制" class="router-link-active router-link-exact-active toc-link level3">4.6.3 使用限制</a></li><!----><!--]--></ul></li><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="_1-mq介绍" tabindex="-1"><a class="header-anchor" href="#_1-mq介绍" aria-hidden="true">#</a> 1. MQ介绍</h1><h2 id="_1-1-为什么要用mq" tabindex="-1"><a class="header-anchor" href="#_1-1-为什么要用mq" aria-hidden="true">#</a> 1.1 为什么要用MQ</h2><p>消息队列是一种“先进先出”的数据结构</p><figure><img src="/assets/queue1-4098ec8b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>其应用场景主要包含以下3个方面</p><ul><li>应用解耦</li></ul><p>系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。</p><figure><img src="/assets/解耦1-a5463bfc.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>使用消息队列解耦合，系统的耦合性就会提高了。比如物流系统发生故障，需要几分钟才能来修复，在这段时间内，物流系统要处理的数据被缓存到消息队列中，用户的下单操作正常完成。当物流系统回复后，补充处理存在消息队列中的订单消息即可，终端系统感知不到物流系统发生过几分钟故障。</p><figure><img src="/assets/解耦2-2b52c87b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>流量削峰</li></ul><figure><img src="/assets/mq-5-2bf10c8f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>应用系统如果遇到系统请求流量的瞬间猛增，有可能会将系统压垮。有了消息队列可以将大量请求缓存起来，分散到很长一段时间处理，这样可以大大提到系统的稳定性和用户体验。</p><figure><img src="/assets/mq-6-348f4851.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>一般情况，为了保证系统的稳定性，如果系统负载超过阈值，就会阻止用户请求，这会影响用户体验，而如果使用消息队列将请求缓存起来，等待系统处理完毕后通知用户下单完毕，这样总不能下单体验要好。</p><p><u>处于经济考量目的：</u></p><p>业务系统正常时段的QPS如果是1000，流量最高峰是10000，为了应对流量高峰配置高性能的服务器显然不划算，这时可以使用消息队列对峰值流量削峰</p><ul><li>数据分发</li></ul><figure><img src="/assets/mq-1-93d512df.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>通过消息队列可以让数据在多个系统更加之间进行流通。数据的产生方不需要关心谁来使用数据，只需要将数据发送到消息队列，数据使用方直接在消息队列中直接获取数据即可</p><figure><img src="/assets/mq-2-50f6aa1e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_1-2-mq的优点和缺点" tabindex="-1"><a class="header-anchor" href="#_1-2-mq的优点和缺点" aria-hidden="true">#</a> 1.2 MQ的优点和缺点</h2><p>优点：解耦、削峰、数据分发</p><p>缺点包含以下几点：</p><ul><li><p>系统可用性降低</p><p>系统引入的外部依赖越多，系统稳定性越差。一旦MQ宕机，就会对业务造成影响。</p><p>如何保证MQ的高可用？</p></li><li><p>系统复杂度提高</p><p>MQ的加入大大增加了系统的复杂度，以前系统间是同步的远程调用，现在是通过MQ进行异步调用。</p><p>如何保证消息没有被重复消费？怎么处理消息丢失情况？那么保证消息传递的顺序性？</p></li><li><p>一致性问题</p><p>A系统处理完业务，通过MQ给B、C、D三个系统发消息数据，如果B系统、C系统处理成功，D系统处理失败。</p><p>如何保证消息数据处理的一致性？</p></li></ul><h2 id="_1-3-各种mq产品的比较" tabindex="-1"><a class="header-anchor" href="#_1-3-各种mq产品的比较" aria-hidden="true">#</a> 1.3 各种MQ产品的比较</h2><p>常见的MQ产品包括Kafka、ActiveMQ、RabbitMQ、RocketMQ。</p><figure><img src="/assets/MQ比较-4974f098.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="_2-rocketmq快速入门" tabindex="-1"><a class="header-anchor" href="#_2-rocketmq快速入门" aria-hidden="true">#</a> 2. RocketMQ快速入门</h1><p>RocketMQ是阿里巴巴2016年MQ中间件，使用Java语言开发，在阿里内部，RocketMQ承接了例如“双11”等高并发场景的消息流转，能够处理万亿级别的消息。</p><h2 id="_2-1-准备工作" tabindex="-1"><a class="header-anchor" href="#_2-1-准备工作" aria-hidden="true">#</a> 2.1 准备工作</h2><h3 id="_2-1-1-下载rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-1-1-下载rocketmq" aria-hidden="true">#</a> 2.1.1 下载RocketMQ</h3><p>RocketMQ最新版本：4.5.1</p><p><a href="https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip" target="_blank" rel="noopener noreferrer">下载地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_2-2-2-环境要求" tabindex="-1"><a class="header-anchor" href="#_2-2-2-环境要求" aria-hidden="true">#</a> 2.2.2 环境要求</h3><ul><li><p>Linux64位系统</p></li><li><p>JDK1.8(64位)</p></li><li><p>源码安装需要安装Maven 3.2.x</p></li></ul><h2 id="_2-2-安装rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-2-安装rocketmq" aria-hidden="true">#</a> 2.2 安装RocketMQ</h2><h3 id="_2-2-1-安装步骤" tabindex="-1"><a class="header-anchor" href="#_2-2-1-安装步骤" aria-hidden="true">#</a> 2.2.1 安装步骤</h3><p>本教程以二进制包方式安装</p><ol><li>解压安装包</li><li>进入安装目录</li></ol><h3 id="_2-2-2-目录介绍" tabindex="-1"><a class="header-anchor" href="#_2-2-2-目录介绍" aria-hidden="true">#</a> 2.2.2 目录介绍</h3><ul><li>bin：启动脚本，包括shell脚本和CMD脚本</li><li>conf：实例配置文件 ，包括broker配置文件、logback配置文件等</li><li>lib：依赖jar包，包括Netty、commons-lang、FastJSON等</li></ul><h2 id="_2-3-启动rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-3-启动rocketmq" aria-hidden="true">#</a> 2.3 启动RocketMQ</h2><ol><li>启动NameServer</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.启动NameServer</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqnamesrv <span class="token operator">&amp;</span>
<span class="token comment"># 2.查看启动日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> ~/logs/rocketmqlogs/namesrv.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>启动Broker</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.启动Broker</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqbroker <span class="token parameter variable">-n</span> localhost:9876 <span class="token operator">&amp;</span>
<span class="token comment"># 2.查看启动日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> ~/logs/rocketmqlogs/broker.log 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>问题描述：</p><p>RocketMQ默认的虚拟机内存较大，启动Broker如果因为内存不足失败，需要编辑如下两个配置文件，修改JVM内存大小</p></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 编辑runbroker.sh和runserver.sh修改默认JVM大小</span>
<span class="token function">vi</span> runbroker.sh
<span class="token function">vi</span> runserver.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>参考设置：</li></ul><p><code>JAVA_OPT=&quot;${JAVA_OPT} -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</code></p><h2 id="_2-4-测试rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-4-测试rocketmq" aria-hidden="true">#</a> 2.4 测试RocketMQ</h2><h3 id="_2-4-1-发送消息" tabindex="-1"><a class="header-anchor" href="#_2-4-1-发送消息" aria-hidden="true">#</a> 2.4.1 发送消息</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.设置环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESRV_ADDR</span><span class="token operator">=</span>localhost:9876
<span class="token comment"># 2.使用安装包的Demo发送消息</span>
<span class="token function">sh</span> bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-2-接收消息" tabindex="-1"><a class="header-anchor" href="#_2-4-2-接收消息" aria-hidden="true">#</a> 2.4.2 接收消息</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.设置环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESRV_ADDR</span><span class="token operator">=</span>localhost:9876
<span class="token comment"># 2.接收消息</span>
<span class="token function">sh</span> bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-5-关闭rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-5-关闭rocketmq" aria-hidden="true">#</a> 2.5 关闭RocketMQ</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1.关闭NameServer</span>
<span class="token function">sh</span> bin/mqshutdown namesrv
<span class="token comment"># 2.关闭Broker</span>
<span class="token function">sh</span> bin/mqshutdown broker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-6-基于docker方式搭建rocketmq" tabindex="-1"><a class="header-anchor" href="#_2-6-基于docker方式搭建rocketmq" aria-hidden="true">#</a> 2.6 基于Docker方式搭建RocketMQ</h2><h3 id="_2-6-1-去https-hub-docker-com-搜索docker镜像" tabindex="-1"><a class="header-anchor" href="#_2-6-1-去https-hub-docker-com-搜索docker镜像" aria-hidden="true">#</a> 2.6.1 去<code>https://hub.docker.com</code> 搜索Docker镜像</h3><p><a href="https://hub.docker.com/r/apache/rocketmq/tags" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/apache/rocketmq/tags<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_2-6-2-基于5-1-0版本构建" tabindex="-1"><a class="header-anchor" href="#_2-6-2-基于5-1-0版本构建" aria-hidden="true">#</a> 2.6.2 基于5.1.0版本构建</h3><h4 id="_1、拉取镜像" tabindex="-1"><a class="header-anchor" href="#_1、拉取镜像" aria-hidden="true">#</a> 1、拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull apache/rocketmq
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2、启动服务" tabindex="-1"><a class="header-anchor" href="#_2、启动服务" aria-hidden="true">#</a> 2、启动服务</h4><p>RocketMQ需要启动两个服务：namesrv和broker</p><h5 id="_2-1、启动namesrc服务" tabindex="-1"><a class="header-anchor" href="#_2-1、启动namesrc服务" aria-hidden="true">#</a> 2.1、启动namesrc服务</h5><h6 id="_2-1-1-创建目录" tabindex="-1"><a class="header-anchor" href="#_2-1-1-创建目录" aria-hidden="true">#</a> 2.1.1 创建目录</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/rocketmq/namesrv/logs
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/rocketmq/namesrv/store
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /data/rocketmq/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-1-2-启动容器" tabindex="-1"><a class="header-anchor" href="#_2-1-2-启动容器" aria-hidden="true">#</a> 2.1.2 启动容器</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">--name</span> rmqnamesrv <span class="token parameter variable">-p</span> <span class="token number">9876</span>:9876 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /data/rocketmq/namesrv/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /data/rocketmq/namesrv/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;MAX_POSSIBLE_HEAP=100000000&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPT_EXT=-server -Xms512m -Xmx512m -Xmn256m&quot;</span> <span class="token punctuation">\</span>
apache/rocketmq <span class="token function">sh</span> mqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-1-3-参数含义" tabindex="-1"><a class="header-anchor" href="#_2-1-3-参数含义" aria-hidden="true">#</a> 2.1.3 参数含义</h6><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-d</code></td><td>以守护进程的方式启动</td></tr><tr><td><code>--restart=always</code></td><td>docker重启时候容器自动重启</td></tr><tr><td><code>--name rmqnamesrv</code></td><td>把容器的名字设置为rmqnamesrv</td></tr><tr><td><code>-p 9876:9876</code></td><td>把容器内的端口9876挂载到宿主机9876上面</td></tr><tr><td><code>-v /data/rocketmq/namesrv/logs:/root/logs</code></td><td>把容器内的<code>/root/logs</code>日志目录挂载到宿主机的 <code>/data/rocketmq/namesrv/logs</code></td></tr><tr><td><code>-v /data/rocketmq/namesrv/store:/root/store</code></td><td>把容器内的/root/store数据存储目录挂载到宿主机的 <code>/data/rocketmq/namesrv/store</code></td></tr><tr><td>rmqnamesrv</td><td>容器的名字</td></tr><tr><td>-e “MAX_POSSIBLE_HEAP=100000000”</td><td>设置容器的最大堆内存为100000000</td></tr><tr><td>rocket/rocketmq</td><td>使用的镜像名称</td></tr><tr><td>sh mqnamesrv</td><td>启动namesrv服务</td></tr></tbody></table><h5 id="_2-2、启动broker服务" tabindex="-1"><a class="header-anchor" href="#_2-2、启动broker服务" aria-hidden="true">#</a> 2.2、启动broker服务</h5><h6 id="_2-2-1-创建目录" tabindex="-1"><a class="header-anchor" href="#_2-2-1-创建目录" aria-hidden="true">#</a> 2.2.1 创建目录</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span>  /data/rocketmq/broker/logs   /data/rocketmq/broker/store /data/rocketmq/conf
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /data/rocketmq
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-2-2-创建文件" tabindex="-1"><a class="header-anchor" href="#_2-2-2-创建文件" aria-hidden="true">#</a> 2.2.2 创建文件</h6><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /data/rocketmq/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将内容放入broker.conf文件中</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># 所属集群名称，如果节点较多可以配置多个</span>
<span class="token key attr-name">brokerClusterName</span> <span class="token punctuation">=</span> <span class="token value attr-value">DefaultCluster</span>
<span class="token comment">#broker名称，master和slave使用相同的名称，表明他们的主从关系</span>
<span class="token key attr-name">brokerName</span> <span class="token punctuation">=</span> <span class="token value attr-value">broker-a</span>
<span class="token comment">#0表示Master，大于0表示不同的slave</span>
<span class="token key attr-name">brokerId</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token comment">#表示几点做消息删除动作，默认是凌晨4点</span>
<span class="token key attr-name">deleteWhen</span> <span class="token punctuation">=</span> <span class="token value attr-value">04</span>
<span class="token comment">#在磁盘上保留消息的时长，单位是小时</span>
<span class="token key attr-name">fileReservedTime</span> <span class="token punctuation">=</span> <span class="token value attr-value">48</span>
<span class="token comment">#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；</span>
<span class="token key attr-name">brokerRole</span> <span class="token punctuation">=</span> <span class="token value attr-value">ASYNC_MASTER</span>
<span class="token comment">#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；</span>
<span class="token key attr-name">flushDiskType</span> <span class="token punctuation">=</span> <span class="token value attr-value">ASYNC_FLUSH</span>
<span class="token comment"># 设置broker节点所在服务器的内网ip地址即可</span>
<span class="token key attr-name">brokerIP1</span> <span class="token punctuation">=</span> <span class="token value attr-value">192.168.125.135</span>
<span class="token comment"># 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full</span>
<span class="token key attr-name">diskMaxUsedSpaceRatio</span><span class="token punctuation">=</span><span class="token value attr-value">95</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：配置文件这个ip后面千万不能有空格，否则就会在客户端发送<a href="https://so.csdn.net/so/search?q=mq&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">mq<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>时连接不上topic</p><p>报错：No route info of this topic, kxm</p><figure><img src="/assets/image-20230406103940931-de6b9031.png" alt="image-20230406103940931" tabindex="0" loading="lazy"><figcaption>image-20230406103940931</figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span>  <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker <span class="token punctuation">\</span>
<span class="token parameter variable">--link</span> rmqnamesrv:namesrv <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">10911</span>:10911 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">10909</span>:10909 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span>  /data/rocketmq/broker/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span>  /data/rocketmq/broker/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span>  /data/rocketmq/conf/broker.conf:/opt/rocketmq-4.9.4/conf/broker.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;NAMESRV_ADDR=namesrv:9876&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;MAX_POSSIBLE_HEAP=200000000&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPT_EXT=-server -Xms512m -Xmx512m -Xmn256m&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;autoCreateTopicEnable=true&quot;</span> <span class="token punctuation">\</span>
apache/rocketmq <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /opt/rocketmq-4.9.4/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_2-2-3-参数说明" tabindex="-1"><a class="header-anchor" href="#_2-2-3-参数说明" aria-hidden="true">#</a> 2.2.3 参数说明</h6><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>--link rmqnamesrv:namesrv</td><td>和rmqnamesrv容器通信</td></tr><tr><td>-p 10911:10911</td><td>把容器的非vip通道端口挂载到宿主机</td></tr><tr><td>-p 10909:10909</td><td>把容器的vip通道端口挂载到宿主机</td></tr><tr><td>-e “NAMESRV_ADDR=namesrv:9876”</td><td>指定namesrv的地址为本机namesrv的ip地址:9876</td></tr><tr><td>sh mqbroker -c /opt/rocketmq-4.9.4/conf/broker.conf</td><td>指定配置文件启动broker节点</td></tr><tr><td>-e &quot;JAVA_OPT_EXT=-server -Xms512m -Xmx512m -Xmn256m&quot;</td><td>设置启动内存大小</td></tr><tr><td>autoCreateTopicEnable=true</td><td>自动创建主题</td></tr></tbody></table><h6 id="_2-2-4-opt-rocketmq-4-9-4-conf-broker-conf-这个中的rocketmq的4-9-4版本是如何确定的-从这里看" tabindex="-1"><a class="header-anchor" href="#_2-2-4-opt-rocketmq-4-9-4-conf-broker-conf-这个中的rocketmq的4-9-4版本是如何确定的-从这里看" aria-hidden="true">#</a> 2.2.4 <code>/opt/rocketmq-4.9.4/conf/broker.conf</code> 这个中的rocketmq的4.9.4版本是如何确定的，从这里看</h6><figure><img src="/assets/image-20230406105210337-6f4a642f.png" alt="image-20230406105210337" tabindex="0" loading="lazy"><figcaption>image-20230406105210337</figcaption></figure><figure><img src="/assets/image-20230406105253117-40dc93f0.png" alt="image-20230406105253117" tabindex="0" loading="lazy"><figcaption>image-20230406105253117</figcaption></figure><h5 id="_2-3-开放端口号" tabindex="-1"><a class="header-anchor" href="#_2-3-开放端口号" aria-hidden="true">#</a> 2.3 开放端口号</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">9876</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">10911</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">10909</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
firewall-cmd <span class="token parameter variable">--permanent</span> --list-port
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、创建topic" tabindex="-1"><a class="header-anchor" href="#_3、创建topic" aria-hidden="true">#</a> 3、创建Topic</h3><figure><img src="/assets/image-20230406105613268-6571d308.png" alt="image-20230406105613268" tabindex="0" loading="lazy"><figcaption>image-20230406105613268</figcaption></figure><p>使用docker ps 查看rocketmq broker容器</p><p>使用 <code>docker exec -it rmqbroker /bin/bash</code> 进入容器中 （rmqbroker 是容器名字，参见上图）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rmqbroker /bin/bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>容器中，使用 <code>sh mqadmin topicList -n 内网ip:9876</code> 查看存在的topic</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sh</span> mqadmin topicList <span class="token parameter variable">-n</span> <span class="token number">192.168</span>.125.135:9876
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406103940931-de6b9031.png" alt="image-20230406103940931" tabindex="0" loading="lazy"><figcaption>image-20230406103940931</figcaption></figure><p><strong>结果</strong></p><figure><img src="/assets/image-20230406105910540-cbe66b94.png" alt="image-20230406105910540" tabindex="0" loading="lazy"><figcaption>image-20230406105910540</figcaption></figure><p>创建topic , 内网ip 替换成自己的ip ， topicname替换成自己的topic名字</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sh</span> mqadmin updateTopic <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:10911 <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>内网ip<span class="token operator">&gt;</span>:9876 <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>topicname<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sh</span> mqadmin updateTopic <span class="token parameter variable">-b</span> <span class="token number">192.168</span>.125.135:10911 <span class="token parameter variable">-n</span> <span class="token number">192.168</span>.125.135:9876 <span class="token parameter variable">-t</span> my_test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406110350759-c29a63da.png" alt="image-20230406110350759" tabindex="0" loading="lazy"><figcaption>image-20230406110350759</figcaption></figure><p><strong>安装成功</strong></p><h3 id="_4、安装rocketmq-console" tabindex="-1"><a class="header-anchor" href="#_4、安装rocketmq-console" aria-hidden="true">#</a> 4、安装<code>rocketmq-console</code></h3><h4 id="_4-1-拉取镜像" tabindex="-1"><a class="header-anchor" href="#_4-1-拉取镜像" aria-hidden="true">#</a> 4.1 拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull styletang/rocketmq-console-ng
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_4-2-安装" tabindex="-1"><a class="header-anchor" href="#_4-2-安装" aria-hidden="true">#</a> 4.2 安装</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmq-console <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.125.135:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8888</span>:8080 <span class="token punctuation">\</span>
styletang/rocketmq-console-ng

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-开放端口号" tabindex="-1"><a class="header-anchor" href="#_4-3-开放端口号" aria-hidden="true">#</a> 4.3 开放端口号</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8888</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
firewall-cmd <span class="token parameter variable">--permanent</span> --list-port
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-安装成功" tabindex="-1"><a class="header-anchor" href="#_4-4-安装成功" aria-hidden="true">#</a> 4.4 安装成功</h4><figure><img src="/assets/image-20230406111821130-10637cc2.png" alt="image-20230406111821130" tabindex="0" loading="lazy"><figcaption>image-20230406111821130</figcaption></figure><h1 id="_3-rocketmq集群搭建" tabindex="-1"><a class="header-anchor" href="#_3-rocketmq集群搭建" aria-hidden="true">#</a> 3. RocketMQ集群搭建</h1><h2 id="_3-1-各角色介绍" tabindex="-1"><a class="header-anchor" href="#_3-1-各角色介绍" aria-hidden="true">#</a> 3.1 各角色介绍</h2><ul><li>Producer：消息的发送者；举例：发信者</li><li>Consumer：消息接收者；举例：收信者</li><li>Broker：暂存和传输消息；举例：邮局</li><li>NameServer：管理Broker；举例：各个邮局的管理机构</li><li>Topic：区分消息的种类；一个发送者可以发送消息给一个或者多个Topic；一个消息的接收者可以订阅一个或者多个Topic消息</li><li>Message Queue：相当于是Topic的分区；用于并行发送和接收消息</li></ul><figure><img src="/assets/RocketMQ角色-b8eca656.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_3-2-集群搭建方式" tabindex="-1"><a class="header-anchor" href="#_3-2-集群搭建方式" aria-hidden="true">#</a> 3.2 集群搭建方式</h2><h3 id="_3-2-1-集群特点" tabindex="-1"><a class="header-anchor" href="#_3-2-1-集群特点" aria-hidden="true">#</a> 3.2.1 集群特点</h3><ul><li><p>NameServer是一个几乎无状态节点，可集群部署，节点之间无任何信息同步。</p></li><li><p>Broker部署相对复杂，Broker分为Master与Slave，一个Master可以对应多个Slave，但是一个Slave只能对应一个Master，Master与Slave的对应关系通过指定相同的BrokerName，不同的BrokerId来定义，BrokerId为0表示Master，非0表示Slave。Master也可以部署多个。每个Broker与NameServer集群中的所有节点建立长连接，定时注册Topic信息到所有NameServer。</p></li><li><p>Producer与NameServer集群中的其中一个节点（随机选择）建立长连接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master建立长连接，且定时向Master发送心跳。Producer完全无状态，可集群部署。</p></li><li><p>Consumer与NameServer集群中的其中一个节点（随机选择）建立长连接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master、Slave建立长连接，且定时向Master、Slave发送心跳。Consumer既可以从Master订阅消息，也可以从Slave订阅消息，订阅规则由Broker配置决定。</p></li></ul><h3 id="_3-2-3-集群模式" tabindex="-1"><a class="header-anchor" href="#_3-2-3-集群模式" aria-hidden="true">#</a> 3.2.3 集群模式</h3><h4 id="_1-单master模式" tabindex="-1"><a class="header-anchor" href="#_1-单master模式" aria-hidden="true">#</a> 1）单Master模式</h4><p>这种方式风险较大，一旦Broker重启或者宕机时，会导致整个服务不可用。不建议线上环境使用,可以用于本地测试。</p><h4 id="_2-多master模式" tabindex="-1"><a class="header-anchor" href="#_2-多master模式" aria-hidden="true">#</a> 2）多Master模式</h4><p>一个集群无Slave，全是Master，例如2个Master或者3个Master，这种模式的优缺点如下：</p><ul><li>优点：配置简单，单个Master宕机或重启维护对应用无影响，在磁盘配置为RAID10时，即使机器宕机不可恢复情况下，由于RAID10磁盘非常可靠，消息也不会丢（异步刷盘丢失少量消息，同步刷盘一条不丢），性能最高；</li><li>缺点：单台机器宕机期间，这台机器上未被消费的消息在机器恢复之前不可订阅，消息实时性会受到影响。</li></ul><h4 id="_3-多master多slave模式-异步" tabindex="-1"><a class="header-anchor" href="#_3-多master多slave模式-异步" aria-hidden="true">#</a> 3）多Master多Slave模式（异步）</h4><p>每个Master配置一个Slave，有多对Master-Slave，HA采用异步复制方式，主备有短暂消息延迟（毫秒级），这种模式的优缺点如下：</p><ul><li>优点：即使磁盘损坏，消息丢失的非常少，且消息实时性不会受影响，同时Master宕机后，消费者仍然可以从Slave消费，而且此过程对应用透明，不需要人工干预，性能同多Master模式几乎一样；</li><li>缺点：Master宕机，磁盘损坏情况下会丢失少量消息。</li></ul><h4 id="_4-多master多slave模式-同步" tabindex="-1"><a class="header-anchor" href="#_4-多master多slave模式-同步" aria-hidden="true">#</a> 4）多Master多Slave模式（同步）</h4><p>每个Master配置一个Slave，有多对Master-Slave，HA采用同步双写方式，即只有主备都写成功，才向应用返回成功，这种模式的优缺点如下：</p><ul><li>优点：数据与服务都无单点故障，Master宕机情况下，消息无延迟，服务可用性与数据可用性都非常高；</li><li>缺点：性能比异步复制模式略低（大约低10%左右），发送单个消息的RT会略高，且目前版本在主节点宕机后，备机不能自动切换为主机。</li></ul><h2 id="_3-3-双主双从集群搭建" tabindex="-1"><a class="header-anchor" href="#_3-3-双主双从集群搭建" aria-hidden="true">#</a> 3.3 双主双从集群搭建</h2><h3 id="_3-3-1-总体架构" tabindex="-1"><a class="header-anchor" href="#_3-3-1-总体架构" aria-hidden="true">#</a> 3.3.1 总体架构</h3><p>消息高可用采用2m-2s（同步双写）方式</p><figure><img src="/assets/RocketMQ集群-54d90065.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-3-2-集群工作流程" tabindex="-1"><a class="header-anchor" href="#_3-3-2-集群工作流程" aria-hidden="true">#</a> 3.3.2 集群工作流程</h3><ol><li>启动NameServer，NameServer起来后监听端口，等待Broker、Producer、Consumer连上来，相当于一个路由控制中心。</li><li>Broker启动，跟所有的NameServer保持长连接，定时发送心跳包。心跳包中包含当前Broker信息(IP+端口等)以及存储所有Topic信息。注册成功后，NameServer集群中就有Topic跟Broker的映射关系。</li><li>收发消息前，先创建Topic，创建Topic时需要指定该Topic要存储在哪些Broker上，也可以在发送消息时自动创建Topic。</li><li>Producer发送消息，启动时先跟NameServer集群中的其中一台建立长连接，并从NameServer中获取当前发送的Topic存在哪些Broker上，轮询从队列列表中选择一个队列，然后与队列所在的Broker建立长连接从而向Broker发消息。</li><li>Consumer跟Producer类似，跟其中一台NameServer建立长连接，获取当前订阅Topic存在哪些Broker上，然后直接跟Broker建立连接通道，开始消费消息。</li></ol><h3 id="_3-3-3-服务器环境" tabindex="-1"><a class="header-anchor" href="#_3-3-3-服务器环境" aria-hidden="true">#</a> 3.3.3 服务器环境</h3><table><thead><tr><th><strong>序号</strong></th><th><strong>IP</strong></th><th><strong>角色</strong></th><th><strong>架构模式</strong></th></tr></thead><tbody><tr><td>1</td><td>192.168.25.135</td><td>nameserver、brokerserver</td><td>Master1、Slave2</td></tr><tr><td>2</td><td>192.168.25.138</td><td>nameserver、brokerserver</td><td>Master2、Slave1</td></tr></tbody></table><h3 id="_3-3-4-host添加信息" tabindex="-1"><a class="header-anchor" href="#_3-3-4-host添加信息" aria-hidden="true">#</a> 3.3.4 Host添加信息</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/hosts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>配置如下:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nameserver</span>
<span class="token number">192.168</span>.25.135 rocketmq-nameserver1
<span class="token number">192.168</span>.25.138 rocketmq-nameserver2
<span class="token comment"># broker</span>
<span class="token number">192.168</span>.25.135 rocketmq-master1
<span class="token number">192.168</span>.25.135 rocketmq-slave2
<span class="token number">192.168</span>.25.138 rocketmq-master2
<span class="token number">192.168</span>.25.138 rocketmq-slave1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完成后, 重启网卡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl restart network
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-5-防火墙配置" tabindex="-1"><a class="header-anchor" href="#_3-3-5-防火墙配置" aria-hidden="true">#</a> 3.3.5 防火墙配置</h3><p>宿主机需要远程访问虚拟机的rocketmq服务和web服务，需要开放相关的端口号，简单粗暴的方式是直接关闭防火墙</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 关闭防火墙</span>
systemctl stop firewalld.service 
<span class="token comment"># 查看防火墙的状态</span>
firewall-cmd <span class="token parameter variable">--state</span> 
<span class="token comment"># 禁止firewall开机启动</span>
systemctl disable firewalld.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者为了安全，只开放特定的端口号，RocketMQ默认使用3个端口：9876 、10911 、11011 。如果防火墙没有关闭的话，那么防火墙就必须开放这些端口：</p><ul><li><code>nameserver</code> 默认使用 9876 端口</li><li><code>master</code> 默认使用 10911 端口</li><li><code>slave</code> 默认使用11011 端口</li></ul><p>执行以下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 开放name server默认端口</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">9876</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># 开放master默认端口</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">10911</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># 开放slave默认端口 (当前集群模式可不开启)</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">11011</span>/tcp <span class="token parameter variable">--permanent</span> 
<span class="token comment"># 重启防火墙</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-6-环境变量配置" tabindex="-1"><a class="header-anchor" href="#_3-3-6-环境变量配置" aria-hidden="true">#</a> 3.3.6 环境变量配置</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在profile文件的末尾加入如下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#set rocketmq</span>
<span class="token assign-left variable">ROCKETMQ_HOME</span><span class="token operator">=</span>/usr/local/rocketmq/rocketmq-all-4.4.0-bin-release
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ROCKETMQ_HOME</span>/bin
<span class="token builtin class-name">export</span> ROCKETMQ_HOME <span class="token environment constant">PATH</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输入:wq! 保存并退出， 并使得配置立刻生效：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-7-创建消息存储路径" tabindex="-1"><a class="header-anchor" href="#_3-3-7-创建消息存储路径" aria-hidden="true">#</a> 3.3.7 创建消息存储路径</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> /usr/local/rocketmq/store
<span class="token function">mkdir</span> /usr/local/rocketmq/store/commitlog
<span class="token function">mkdir</span> /usr/local/rocketmq/store/consumequeue
<span class="token function">mkdir</span> /usr/local/rocketmq/store/index
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-8-broker配置文件" tabindex="-1"><a class="header-anchor" href="#_3-3-8-broker配置文件" aria-hidden="true">#</a> 3.3.8 broker配置文件</h3><h4 id="_1-master1" tabindex="-1"><a class="header-anchor" href="#_1-master1" aria-hidden="true">#</a> 1）master1</h4><p>服务器：192.168.25.135</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-a.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-a
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SYNC_MASTER
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>SYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-slave2" tabindex="-1"><a class="header-anchor" href="#_2-slave2" aria-hidden="true">#</a> 2）slave2</h4><p>服务器：192.168.25.135</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-b-s.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-b
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">11011</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SLAVE
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>ASYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-master2" tabindex="-1"><a class="header-anchor" href="#_3-master2" aria-hidden="true">#</a> 3）master2</h4><p>服务器：192.168.25.138</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-b.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-b
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SYNC_MASTER
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>SYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-slave1" tabindex="-1"><a class="header-anchor" href="#_4-slave1" aria-hidden="true">#</a> 4）slave1</h4><p>服务器：192.168.25.138</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-a-s.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-a
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">11011</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/store/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/usr/local/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SLAVE
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>ASYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-9-修改启动脚本文件" tabindex="-1"><a class="header-anchor" href="#_3-3-9-修改启动脚本文件" aria-hidden="true">#</a> 3.3.9 修改启动脚本文件</h3><h4 id="_1-runbroker-sh" tabindex="-1"><a class="header-anchor" href="#_1-runbroker-sh" aria-hidden="true">#</a> 1）<a href="http://runbroker.sh" target="_blank" rel="noopener noreferrer">runbroker.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /usr/local/rocketmq/bin/runbroker.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>需要根据内存大小进行适当的对JVM参数进行调整：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#===================================================</span>
<span class="token comment"># 开发环境配置 JVM Configuration</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms256m -Xmx256m -Xmn128m&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>####2）<a href="http://runserver.sh" target="_blank" rel="noopener noreferrer">runserver.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /usr/local/rocketmq/bin/runserver.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-10-服务启动" tabindex="-1"><a class="header-anchor" href="#_3-3-10-服务启动" aria-hidden="true">#</a> 3.3.10 服务启动</h3><h4 id="_1-启动nameserve集群" tabindex="-1"><a class="header-anchor" href="#_1-启动nameserve集群" aria-hidden="true">#</a> 1）启动NameServe集群</h4><p>分别在192.168.25.135和192.168.25.138启动NameServer</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqnamesrv <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-启动broker集群" tabindex="-1"><a class="header-anchor" href="#_2-启动broker集群" aria-hidden="true">#</a> 2）启动Broker集群</h4><ul><li>在192.168.25.135上启动master1和slave2</li></ul><p>master1：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-syncbroker-a.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>slave2：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-sync/broker-b-s.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在192.168.25.138上启动master2和slave2</li></ul><p>master2</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-sync/broker-b.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>slave1</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /usr/local/rocketmq/conf/2m-2s-sync/broker-a-s.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-11-查看进程状态" tabindex="-1"><a class="header-anchor" href="#_3-3-11-查看进程状态" aria-hidden="true">#</a> 3.3.11 查看进程状态</h3><p>启动后通过JPS查看启动进程</p><figure><img src="/assets/jps1-83850453.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-3-12-查看日志" tabindex="-1"><a class="header-anchor" href="#_3-3-12-查看日志" aria-hidden="true">#</a> 3.3.12 查看日志</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看nameServer日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-500f</span> ~/logs/rocketmqlogs/namesrv.log
<span class="token comment"># 查看broker日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-500f</span> ~/logs/rocketmqlogs/broker.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-4-mqadmin管理工具" tabindex="-1"><a class="header-anchor" href="#_3-4-mqadmin管理工具" aria-hidden="true">#</a> 3.4 mqadmin管理工具</h2><h3 id="_3-4-1-使用方式" tabindex="-1"><a class="header-anchor" href="#_3-4-1-使用方式" aria-hidden="true">#</a> 3.4.1 使用方式</h3><p>进入RocketMQ安装位置，在bin目录下执行<code>./mqadmin {command} {args}</code></p><h3 id="_3-4-2-命令介绍" tabindex="-1"><a class="header-anchor" href="#_3-4-2-命令介绍" aria-hidden="true">#</a> 3.4.2 命令介绍</h3><h4 id="_1-topic相关" tabindex="-1"><a class="header-anchor" href="#_1-topic相关" aria-hidden="true">#</a> 1）Topic相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="132" style="height:99.0pt;"><td rowspan="8" height="593" class="xl68" width="163" style="border-bottom:1.0pt;height:444.0pt;border-top:none;width:122pt;">updateTopic</td><td rowspan="8" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">创建更新Topic配置</td><td class="xl65" width="149" style="width:112pt;">-b</td><td class="xl66" width="159" style="width:119pt;">Broker 地址，表示 topic 所在 Broker，只支持单台Broker，地址为ip:port</td></tr><tr height="132" style="height:99.0pt;"><td height="132" class="xl65" width="149" style="height:99.0pt;width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">cluster 名称，表示 topic 所在集群（集群可通过 clusterList 查询）</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h-</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer服务地址，格式 ip:port</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl65" width="149" style="height:57.0pt;width:112pt;">-p</td><td class="xl66" width="159" style="width:119pt;">指定新topic的读写权限( W=2|R=4|WR=6 )</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-r</td><td class="xl66" width="159" style="width:119pt;">可读队列数（默认为 8）</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-w</td><td class="xl66" width="159" style="width:119pt;">可写队列数（默认为 8）</td></tr><tr height="95" style="height:71.0pt;"><td height="95" class="xl65" width="149" style="height:71.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称（名称只能使用字符 ^[a-zA-Z0-9_-]+$ ）</td></tr><tr height="132" style="height:99.0pt;"><td rowspan="4" height="307" class="xl68" width="163" style="border-bottom:1.0pt;height:230.0pt;border-top:none;width:122pt;">deleteTopic</td><td rowspan="4" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">删除Topic</td><td class="xl65" width="149" style="width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">cluster 名称，表示删除某集群下的某个 topic （集群 可通过 clusterList 查询）</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="95" style="height:71.0pt;"><td height="95" class="xl65" width="149" style="height:71.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称（名称只能使用字符 ^[a-zA-Z0-9_-]+$ ）</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="287" class="xl68" width="163" style="border-bottom:1.0pt;height:215.0pt;border-top:none;width:122pt;">topicList</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 列表信息</td><td class="xl65" width="149" style="width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="207" style="height:155.0pt;"><td height="207" class="xl65" width="149" style="height:155.0pt;width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">不配置-c只返回topic列表，增加-c返回clusterName, topic, consumerGroup信息，即topic的所属集群和订阅关系，没有参数</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" class="xl68" width="163" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicRoute</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 路由信息</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" class="xl68" width="163" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicStatus</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 消息队列offset</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" class="xl68" width="163" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicClusterList</td><td rowspan="3" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 所在集群列表</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="6" height="518" class="xl68" width="163" style="border-bottom:1.0pt;height:380pt;border-top:none;width:122pt;">updateTopicPerm</td><td rowspan="6" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">更新 Topic 读写权限</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="132" style="height:99.0pt;"><td height="132" class="xl65" width="149" style="height:99.0pt;width:112pt;">-b</td><td class="xl66" width="159" style="width:119pt;">Broker 地址，表示 topic 所在 Broker，只支持单台Broker，地址为ip:port</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl65" width="149" style="height:57.0pt;width:112pt;">-p</td><td class="xl66" width="159" style="width:119pt;">指定新 topic 的读写权限( W=2|R=4|WR=6 )</td></tr><tr height="207" style="height:155.0pt;"><td height="207" class="xl65" width="149" style="height:155.0pt;width:112pt;">-c</td><td class="xl66" width="159" style="width:119pt;">cluster 名称，表示 topic 所在集群（集群可通过 clusterList 查询），-b优先，如果没有-b，则对集群中所有Broker执行命令</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="5" height="199" class="xl68" width="163" style="border-bottom:1.0pt;height:149.0pt;border-top:none;width:122pt;">updateOrderConf</td><td rowspan="5" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">从NameServer上创建、删除、获取特定命名空间的kv配置，目前还未启用</td><td class="xl65" width="149" style="width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic，键</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-v</td><td class="xl66" width="159" style="width:119pt;">orderConf，值</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-m</td><td class="xl66" width="159" style="width:119pt;">method，可选get、put、delete</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="198" class="xl68" width="163" style="border-bottom:1.0pt;height:140pt;border-top:none;width:122pt;">allocateMQ</td><td rowspan="4" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">以平均负载算法计算消费者列表负载消息队列的负载结果</td><td class="xl65" width="149" style="width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="95" style="height:71.0pt;"><td height="95" class="xl65" width="149" style="height:71.0pt;width:112pt;">-i</td><td class="xl66" width="159" style="width:119pt;">ipList，用逗号分隔，计算这些ip去负载Topic的消息队列</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="142" class="xl68" width="163" style="border-bottom:1.0pt solid black;height:106.0pt;border-top:1.0pt;width:122pt;">statsAll</td><td rowspan="4" class="xl70" width="135" style="border-bottom:1.0pt;border-top:none;width:101pt;">打印Topic订阅关系、TPS、积累量、24h读写总量等信息</td><td class="xl65" width="149" style="width:112pt;">-h</td><td class="xl66" width="159" style="width:119pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="149" style="height:43.0pt;width:112pt;">-n</td><td class="xl66" width="159" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="149" style="height:29.0pt;width:112pt;">-a</td><td class="xl66" width="159" style="width:119pt;">是否只打印活跃topic</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="149" style="height:17.0pt;width:112pt;">-t</td><td class="xl66" width="159" style="width:119pt;">指定topic</td></tr></table> #### 2）集群相关 <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="207" style="height:155.0pt;"><td rowspan="4" height="326" class="xl67" width="177" style="border-bottom:1.0pt;height:244.0pt;border-top:none;width:133pt;"><span style="mso-spacerun:yes;"></span>clusterList</td><td rowspan="4" class="xl70" width="175" style="border-bottom:1.0pt;border-top:none;width:131pt;">查看集群信息，集群、BrokerName、BrokerId、TPS等信息</td><td class="xl65" width="177" style="width:133pt;">-m</td><td class="xl66" width="185" style="width:139pt;">打印更多信息 (增加打印出如下信息 #InTotalYest, #OutTotalYest, #InTotalToday ,#OutTotalToday)</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="177" style="height:17.0pt;width:133pt;">-h</td><td class="xl66" width="185" style="width:139pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="177" style="height:43.0pt;width:133pt;">-n</td><td class="xl66" width="185" style="width:139pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-i</td><td class="xl66" width="185" style="width:139pt;">打印间隔，单位秒</td></tr><tr height="95" style="height:71.0pt;"><td rowspan="8" height="391" class="xl67" width="177" style="border-bottom:1.0pt;height:292.0pt;border-top:none;width:133pt;">clusterRT</td><td rowspan="8" class="xl70" width="175" style="border-bottom:1.0pt;border-top:none;width:131pt;">发送消息检测集群各Broker RT。消息发往${BrokerName} Topic。</td><td class="xl65" width="177" style="width:133pt;">-a</td><td class="xl66" width="185" style="width:139pt;">amount，每次探测的总数，RT = 总时间 / amount</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-s</td><td class="xl66" width="185" style="width:139pt;">消息大小，单位B</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="177" style="height:17.0pt;width:133pt;">-c</td><td class="xl66" width="185" style="width:139pt;">探测哪个集群</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl65" width="177" style="height:57.0pt;width:133pt;">-p</td><td class="xl66" width="185" style="width:139pt;">是否打印格式化日志，以|分割，默认不打印</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl65" width="177" style="height:17.0pt;width:133pt;">-h</td><td class="xl66" width="185" style="width:139pt;">打印帮助</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-m</td><td class="xl66" width="185" style="width:139pt;">所属机房，打印使用</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl65" width="177" style="height:29.0pt;width:133pt;">-i</td><td class="xl66" width="185" style="width:139pt;">发送间隔，单位秒</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl65" width="177" style="height:43.0pt;width:133pt;">-n</td><td class="xl66" width="185" style="width:139pt;">NameServer 服务地址，格式 ip:port</td></tr></table><p>####3）Broker相关</p><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="6" height="206" class="xl69" width="191" style="border-bottom:1.0pt;height:154.0pt;border-top:none;width:143pt;">updateBrokerConfig</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">更新 Broker 配置文件，会修改Broker.conf</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，格式为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">cluster 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl68" width="87" style="width:65pt;">key 值</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-v</td><td class="xl68" width="87" style="width:65pt;">value 值</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="3" height="137" class="xl69" width="191" style="border-bottom:1.0pt;height:103.0pt;border-top:none;width:143pt;">brokerStatus</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">查看 Broker 统计信息、运行状态（你想要的信息几乎都在里面）</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="6" height="256" class="xl69" width="191" style="border-bottom:1.0pt;height:192.0pt;border-top:none;width:143pt;">brokerConsumeStats</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">Broker中各个消费者的消费情况，按Message Queue维度返回Consume Offset，Broker Offset，Diff，TImestamp等信息</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">请求超时时间</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-l</td><td class="xl68" width="87" style="width:65pt;">diff阈值，超过阈值才打印</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">是否为顺序topic，一般为false</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="2" height="114" class="xl69" width="191" style="border-bottom:1.0pt;height:86.0pt;border-top:none;width:143pt;">getBrokerConfig</td><td rowspan="2" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">获取Broker配置</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="3" height="137" class="xl69" width="191" style="border-bottom:1.0pt;height:103.0pt;border-top:none;width:143pt;">wipeWritePerm</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">从NameServer上清除 Broker写权限</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="4" height="160" class="xl69" width="191" style="border-bottom:1.0pt;height:120.0pt;border-top:none;width:143pt;">cleanExpiredCQ</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">清理Broker上过期的Consume Queue，如果手动减少对列数可能产生过期队列</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="88" style="mso-height-source:userset;height:66.0pt;"><td rowspan="4" height="191" class="xl69" width="191" style="border-bottom:1.0pt;height:143.0pt;border-top:none;width:143pt;">cleanUnusedTopic</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">清理Broker上不使用的Topic，从内存中释放Topic的Consume Queue，如果手动删除Topic会产生不使用的Topic</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 地址，地址为ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="5" height="199" class="xl69" width="191" style="border-bottom:1.0pt;height:149.0pt;border-top:none;width:143pt;">sendMsgStatus</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">向Broker发消息，返回发送状态和RT</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">BrokerName，注意不同于Broker地址</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">消息大小，单位B</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">发送次数</td></tr></table> #### 4）消息相关 <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="128" style="height:96.0pt;"><td rowspan="3" height="208" class="xl69" width="87" style="border-bottom:1.0pt;height:156.0pt;border-top:none;width:65pt;">queryMsgById</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据offsetMsgId查询msg，如果使用开源控制台，应使用offsetMsgId，此命令还有其他参数，具体作用请阅读QueryMsgByIdSubCommand。</td><td class="xl67" width="87" style="width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">msgId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="126" class="xl69" width="87" style="border-bottom:1.0pt;height:94.0pt;border-top:none;width:65pt;">queryMsgByKey</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据消息 Key 查询消息</td><td class="xl67" width="87" style="width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">msgKey</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">Topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="225" style="height:169.0pt;"><td rowspan="6" height="390" class="xl69" width="87" style="border-bottom:1.0pt;height:292.0pt;border-top:none;width:65pt;">queryMsgByOffset</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据 Offset 查询消息</td><td class="xl67" width="87" style="width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker 名称，（这里需要注意 填写的是 Broker 的名称，不是 Broker 的地址，Broker 名称可以在 clusterList 查到）</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-i</td><td class="xl68" width="87" style="width:65pt;">query 队列 id</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">offset 值</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic 名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="47"><td rowspan="6" height="209" class="xl69" width="87" style="border-bottom:1.0pt;height:156.0pt;border-top:none;width:65pt;">queryMsgByUniqueKey</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据msgId查询，msgId不同于offsetMsgId，区别详见常见运维问题。-g，-d配合使用，查到消息后尝试让特定的消费者消费消息并返回消费结果</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">uniqe msg id</td></tr><tr height="36" style="height:27.0pt;"><td height="36" class="xl67" width="87" style="height:27.0pt;width:65pt;">-g</td><td class="xl67" width="87" style="width:65pt;">consumerGroup</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-d</td><td class="xl67" width="87" style="width:65pt;">clientId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="5" height="149" class="xl69" width="87" style="border-bottom:1.0pt
  height:111.0pt;border-top:none;width:65pt;">checkMsgSendRT</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">检测向topic发消息的RT，功能类似clusterRT</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-a</td><td class="xl68" width="87" style="width:65pt;">探测次数</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">消息大小</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="8" height="218" class="xl69" width="87" style="border-bottom:1.0pt;height:162.0pt;border-top:none;width:65pt;">sendMessage</td><td rowspan="8" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">发送一条消息，可以根据配置发往特定Message Queue，或普通发送。</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-p</td><td class="xl68" width="87" style="width:65pt;">body，消息体</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">keys</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl67" width="87" style="width:65pt;">tags</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl67" width="87" style="width:65pt;">BrokerName</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">queueId</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="10" height="312" class="xl69" width="87" style="border-bottom:1.0pt;height:232.0pt;border-top:none;width:65pt;">consumeMessage</td><td rowspan="10" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">消费消息。可以根据offset、开始&amp;结束时间戳、消息队列消费消息，配置不同执行不同消费逻辑，详见ConsumeMessageCommand。</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl67" width="87" style="width:65pt;">BrokerName</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">从offset开始消费</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">queueId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">开始时间戳，格式详见-h</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">结束时间戳</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">消费多少条消息</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="8" height="282" class="xl69" width="87" style="border-bottom:1.0pt;height:210.0pt;border-top:none;width:65pt;">printMsg</td><td rowspan="8" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">从Broker消费消息并打印，可选时间段</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">字符集，例如UTF-8</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">subExpress，过滤表达式</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">开始时间戳，格式参见-h</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-e</td><td class="xl68" width="87" style="width:65pt;">结束时间戳</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">是否打印消息体</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="12" height="390" class="xl69" width="87" style="border-bottom:1.0pt;height:290.0pt;border-top:none;width:65pt;">printMsgByQueue</td><td rowspan="12" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">类似printMsg，但指定Message Queue</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">queueId</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-a</td><td class="xl67" width="87" style="width:65pt;">BrokerName</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">字符集，例如UTF-8</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">subExpress，过滤表达式</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">开始时间戳，格式参见-h</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-e</td><td class="xl68" width="87" style="width:65pt;">结束时间戳</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-p</td><td class="xl68" width="87" style="width:65pt;">是否打印消息</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">是否打印消息体</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-f</td><td class="xl68" width="87" style="width:65pt;">是否统计tag数量并打印</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="7" height="410" class="xl69" width="87" style="border-bottom:1.0pt;height:307.0pt;border-top:none;width:65pt;">resetOffsetByTime</td><td rowspan="7" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">按时间戳重置offset，Broker和consumer都会重置</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">重置为此时间戳对应的offset</td></tr><tr height="188" style="height:141.0pt;"><td height="188" class="xl67" width="87" style="height:141.0pt;width:65pt;">-f</td><td class="xl68" width="87" style="width:65pt;">是否强制重置，如果false，只支持回溯offset，如果true，不管时间戳对应offset与consumeOffset关系</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">是否重置c++客户端offset</td></tr></table><h4 id="_5-消费者、消费组相关" tabindex="-1"><a class="header-anchor" href="#_5-消费者、消费组相关" aria-hidden="true">#</a> 5）消费者、消费组相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="4" height="158" class="xl69" width="87" style="border-bottom:1.0pt;height:110pt;border-top:none;width:65pt;">consumerProgress</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt;border-top:none;width:65pt;">查看订阅组消费状态，可以查看具体的client IP的消息积累量</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者所属组名</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">是否打印client IP</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="105" style="mso-height-source:userset;height:79.0pt;"><td rowspan="5" height="260" class="xl69" width="87" style="border-bottom:1.0pt;height:195.0pt;border-top:none;width:65pt;">consumerStatus</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">查看消费者状态，包括同一个分组中是否都是相同的订阅，分析Process Queue是否堆积，返回消费者jstack结果，内容较多，使用者参见ConsumerStatusSubCommand</td><td class="xl67" width="87" style="width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="36" style="height:27.0pt;"><td height="36" class="xl67" width="87" style="height:27.0pt;width:65pt;">-g</td><td class="xl67" width="87" style="width:65pt;">consumer group</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-i</td><td class="xl67" width="87" style="width:65pt;">clientId</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">是否执行jstack</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="5" height="181" class="xl69" width="87" style="border-bottom:1.0pt
  height:135.0pt;border-top:none;width:65pt;">getConsumerStatus</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">获取 Consumer 消费进度</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者所属组名</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">查询主题</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-i</td><td class="xl68" width="87" style="width:65pt;">Consumer 客户端 ip</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="13" height="761" class="xl69" width="87" style="border-bottom:1.0pt
  height:569.0pt;border-top:none;width:65pt;">updateSubGroup</td><td rowspan="13" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">更新或创建订阅关系</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker地址</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">分组是否允许消费</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-m</td><td class="xl68" width="87" style="width:65pt;">是否从最小offset开始消费</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">是否是广播模式</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-q</td><td class="xl68" width="87" style="width:65pt;">重试队列数量</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-r</td><td class="xl68" width="87" style="width:65pt;">最大重试次数</td></tr><tr height="207" style="height:155.0pt;"><td height="207" class="xl67" width="87" style="height:155.0pt;width:65pt;">-i</td><td class="xl68" width="87" style="width:65pt;">当slaveReadEnable开启时有效，且还未达到从slave消费时建议从哪个BrokerId消费，可以配置备机id，主动从备机消费</td></tr><tr height="132" style="height:99.0pt;"><td height="132" class="xl67" width="87" style="height:99.0pt;width:65pt;">-w</td><td class="xl68" width="87" style="width:65pt;">如果Broker建议从slave消费，配置决定从哪个slave消费，配置BrokerId，例如1</td></tr><tr height="76" style="height:57.0pt;"><td height="76" class="xl67" width="87" style="height:57.0pt;width:65pt;">-a</td><td class="xl68" width="87" style="width:65pt;">当消费者数量变化时是否通知其他消费者负载均衡</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="5" height="165" class="xl69" width="87" style="border-bottom:1.0pt
  height:123.0pt;border-top:none;width:65pt;">deleteSubGroup</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">从Broker删除订阅关系</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-b</td><td class="xl68" width="87" style="width:65pt;">Broker地址</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-c</td><td class="xl68" width="87" style="width:65pt;">集群名称</td></tr><tr height="39" style="height:29.0pt;"><td height="39" class="xl67" width="87" style="height:29.0pt;width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者分组名称</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="6" height="172" class="xl69" width="87" style="border-bottom:1.0pt
  height:120pt;border-top:none;width:65pt;">cloneGroupOffset</td><td rowspan="6" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">在目标群组中使用源群组的offset</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">源消费者组</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-d</td><td class="xl68" width="87" style="width:65pt;">目标消费者组</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">topic名称</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-o</td><td class="xl68" width="87" style="width:65pt;">暂未使用</td></tr></table><h4 id="_6-连接相关" tabindex="-1"><a class="header-anchor" href="#_6-连接相关" aria-hidden="true">#</a> 6）连接相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="3" height="119" class="xl69" width="87" style="border-bottom:1.0pt
  height:89.0pt;border-top:none;width:65pt;">consumerConnec tion</td><td rowspan="3" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">查询 Consumer 的网络连接</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">消费者所属组名</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="39" style="height:29.0pt;"><td rowspan="4" height="142" class="xl69" width="87" style="border-bottom:1.0pt
  height:106.0pt;border-top:none;width:65pt;">producerConnec tion</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">查询 Producer 的网络连接</td><td class="xl67" width="87" style="width:65pt;">-g</td><td class="xl68" width="87" style="width:65pt;">生产者所属组名</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-t</td><td class="xl68" width="87" style="width:65pt;">主题名称</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr></table><h4 id="_7-nameserver相关" tabindex="-1"><a class="header-anchor" href="#_7-nameserver相关" aria-hidden="true">#</a> 7）NameServer相关</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="21" style="height:16.0pt;"><td rowspan="5" height="143" class="xl69" width="87" style="border-bottom:1.0pt
  height:100pt;border-top:none;width:65pt;">updateKvConfig</td><td rowspan="5" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">更新NameServer的kv配置，目前还未使用</td><td class="xl75" width="87" style="width:65pt;">-s</td><td class="xl76" width="87" style="width:65pt;">命名空间</td></tr><tr height="21" style="height:16.0pt;"><td height="21" class="xl75" width="87" style="height:16.0pt;width:65pt;">-k</td><td class="xl75" width="87" style="width:65pt;">key</td></tr><tr height="21" style="height:16.0pt;"><td height="21" class="xl75" width="87" style="height:16.0pt;width:65pt;">-v</td><td class="xl75" width="87" style="width:65pt;">value</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td rowspan="4" height="126" class="xl69" width="87" style="border-bottom:1.0pt
  height:94.0pt;border-top:none;width:65pt;">deleteKvConfig</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">删除NameServer的kv配置</td><td class="xl67" width="87" style="width:65pt;">-s</td><td class="xl68" width="87" style="width:65pt;">命名空间</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">key</td></tr><tr height="57" style="height:43.0pt;"><td height="57" class="xl67" width="87" style="height:43.0pt;width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="2" height="80" class="xl69" width="87" style="border-bottom:1.0pt
  height:60.0pt;border-top:none;width:65pt;">getNamesrvConfig</td><td rowspan="2" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">获取NameServer配置</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="4" height="126" class="xl69" width="87" style="border-bottom:1.0pt
  height:94.0pt;border-top:none;width:65pt;">updateNamesrvConfig</td><td rowspan="4" class="xl72" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">修改NameServer配置</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-k</td><td class="xl67" width="87" style="width:65pt;">key</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-v</td><td class="xl67" width="87" style="width:65pt;">value</td></tr></table><h4 id="_8-其他" tabindex="-1"><a class="header-anchor" href="#_8-其他" aria-hidden="true">#</a> 8）其他</h4><table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"><col width="175"><col width="177"><col width="185"><tr height="23" style="height:17.0pt;"><td height="23" class="xl63" width="177" style="height:17.0pt;width:133pt;">名称</td><td class="xl64" width="175" style="width:131pt;">含义</td><td class="xl64" width="177" style="width:133pt;">命令选项</td><td class="xl64" width="185" style="width:139pt;">说明</td></tr><tr height="57" style="height:43.0pt;"><td rowspan="2" height="80" class="xl69" width="87" style="border-bottom:1.0pt
  height:60.0pt;border-top:none;width:65pt;">startMonitoring</td><td rowspan="2" class="xl71" width="87" style="border-bottom:1.0pt
  border-top:none;width:65pt;">开启监控进程，监控消息误删、重试队列消息数等</td><td class="xl67" width="87" style="width:65pt;">-n</td><td class="xl68" width="87" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr><tr height="23" style="height:17.0pt;"><td height="23" class="xl67" width="87" style="height:17.0pt;width:65pt;">-h</td><td class="xl68" width="87" style="width:65pt;">打印帮助</td></tr></table><h3 id="_3-4-3-注意事项" tabindex="-1"><a class="header-anchor" href="#_3-4-3-注意事项" aria-hidden="true">#</a> 3.4.3 注意事项</h3><ul><li>几乎所有命令都需要配置-n表示NameServer地址，格式为ip:port</li><li>几乎所有命令都可以通过-h获取帮助</li><li>如果既有Broker地址（-b）配置项又有clusterName（-c）配置项，则优先以Broker地址执行命令；如果不配置Broker地址，则对集群中所有主机执行命令</li></ul><h2 id="_3-5-集群监控平台搭建" tabindex="-1"><a class="header-anchor" href="#_3-5-集群监控平台搭建" aria-hidden="true">#</a> 3.5 集群监控平台搭建</h2><h3 id="_3-5-1-概述" tabindex="-1"><a class="header-anchor" href="#_3-5-1-概述" aria-hidden="true">#</a> 3.5.1 概述</h3><p><code>RocketMQ</code>有一个对其扩展的开源项目<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，这个项目中有一个子模块叫<code>rocketmq-console</code>，这个便是管理控制台项目了，先将<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>拉到本地，因为我们需要自己对<code>rocketmq-console</code>进行编译打包运行。</p><figure><img src="/assets/rocketmq-console-cb07b261.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-5-2-下载并编译打包" tabindex="-1"><a class="header-anchor" href="#_3-5-2-下载并编译打包" aria-hidden="true">#</a> 3.5.2 下载并编译打包</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/apache/rocketmq-externals
<span class="token builtin class-name">cd</span> rocketmq-console
mvn clean package <span class="token parameter variable">-Dmaven.test.skip</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：打包前在<code>rocketmq-console</code>中配置<code>namesrv</code>集群地址：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">rocketmq.config.namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.25.135:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.25.138:9876
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动rocketmq-console：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> rocketmq-console-ng-1.0.0.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动成功后，我们就可以通过浏览器访问<code>http://localhost:8080</code>进入控制台界面了，如下图：</p><figure><img src="/assets/rocketmq-console2-d823c2cb.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>集群状态：</p><figure><img src="/assets/rocketmq-console3-0d09acfe.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="_4-消息发送样例" tabindex="-1"><a class="header-anchor" href="#_4-消息发送样例" aria-hidden="true">#</a> 4. 消息发送样例</h1><ul><li>导入MQ客户端依赖</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.rocketmq/rocketmq-client --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>消息发送者步骤分析r</li></ul><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>1.创建消息生产者producer，并制定生产者组名
2.指定Nameserver地址
3.启动producer
4.创建消息对象，指定主题Topic、Tag和消息体
5.发送消息
6.关闭生产者producer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>消息消费者步骤分析</li></ul><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>1.创建消费者Consumer，制定消费者组名
2.指定Nameserver地址
3.订阅主题Topic和Tag
4.设置回调函数，处理消息
5.启动消费者consumer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-1-基本样例" tabindex="-1"><a class="header-anchor" href="#_4-1-基本样例" aria-hidden="true">#</a> 4.1 基本样例</h2><h3 id="_4-1-1-消息发送" tabindex="-1"><a class="header-anchor" href="#_4-1-1-消息发送" aria-hidden="true">#</a> 4.1.1 消息发送</h3><h4 id="_1-发送同步消息" tabindex="-1"><a class="header-anchor" href="#_1-发送同步消息" aria-hidden="true">#</a> 1）发送同步消息</h4><p>这种可靠性同步地发送方式使用的比较广泛，比如：重要的消息通知，短信通知。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
    	producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	    <span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
    	    <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
        	<span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
        	<span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送消息到一个Broker</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 通过sendResult返回消息是否成功送达</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-发送异步消息" tabindex="-1"><a class="header-anchor" href="#_2-发送异步消息" aria-hidden="true">#</a> 2）发送异步消息</h4><p>异步消息通常用在对响应时间敏感的业务场景，即发送端不能容忍长时间地等待Broker的响应。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
            	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;OrderID188&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// SendCallback接收异步返回结果的回调</span>
                producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d OK %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                            sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d Exception %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      	              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
            	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-单向发送消息" tabindex="-1"><a class="header-anchor" href="#_3-单向发送消息" aria-hidden="true">#</a> 3）单向发送消息</h4><p>这种方式主要用在不特别关心发送结果的场景，例如日志发送。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnewayProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
        	<span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送单向消息，没有任何返回结果</span>
        	producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-1-2-消费消息" tabindex="-1"><a class="header-anchor" href="#_4-1-2-消费消息" aria-hidden="true">#</a> 4.1.2 消费消息</h3><h4 id="_1-负载均衡模式" tabindex="-1"><a class="header-anchor" href="#_1-负载均衡模式" aria-hidden="true">#</a> 1）负载均衡模式</h4><p>消费者采用负载均衡方式消费消息，多个消费者共同消费队列消息，每个消费者处理的消息不同</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例化消息生产者,指定组名</span>
    <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定Namesrv地址信息.</span>
    consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 订阅Topic</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//负载均衡模式消费</span>
    consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册回调函数，处理消息</span>
    consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                        <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> 
                              <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动消息者</span>
    consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-广播模式" tabindex="-1"><a class="header-anchor" href="#_2-广播模式" aria-hidden="true">#</a> 2）广播模式</h4><p>消费者采用广播的方式消费消息，每个消费者消费的消息都是相同的</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例化消息生产者,指定组名</span>
    <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定Namesrv地址信息.</span>
    consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 订阅Topic</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//广播模式消费</span>
    consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">BROADCASTING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册回调函数，处理消息</span>
    consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                        <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> 
                              <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动消息者</span>
    consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-1-3-工具类的封装" tabindex="-1"><a class="header-anchor" href="#_4-1-3-工具类的封装" aria-hidden="true">#</a> 4.1.3 工具类的封装</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>lyf<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQPushConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">MessageSelector</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQClientException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">DefaultMQProducer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>heartbeat<span class="token punctuation">.</span></span><span class="token class-name">MessageModel</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> lyf
 * <span class="token keyword">@version</span> 1.0
 * <span class="token keyword">@classname</span> RocketMqUtil
 * <span class="token keyword">@description</span>
 * <span class="token keyword">@date</span> 2023/4/6 16:27
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RocketMqUtil</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 私有构造器
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMqUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 创建生产者
     *
     * <span class="token keyword">@param</span> <span class="token parameter">producerConsumer</span> 传入的函数
     * <span class="token keyword">@param</span> <span class="token parameter">group</span>            消息组
     * <span class="token keyword">@param</span> <span class="token parameter">nameServerAddr</span>   NameServer的地址
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">MQClientException</span></span> MQClientException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createMqProducer</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DefaultMQProducer</span><span class="token punctuation">&gt;</span></span> producerConsumer<span class="token punctuation">,</span> <span class="token class-name">String</span> group<span class="token punctuation">,</span> <span class="token class-name">String</span> nameServerAddr<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1 实例化消息的生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span>nameServerAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4 发送消息</span>
        producerConsumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>producer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5 释放资源</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 创建消费者
     *
     * <span class="token keyword">@param</span> <span class="token parameter">pushConsumer</span>  消费函数
     * <span class="token keyword">@param</span> <span class="token parameter">group</span>         消费者组
     * <span class="token keyword">@param</span> <span class="token parameter">nameServer</span>    NameServer地址
     * <span class="token keyword">@param</span> <span class="token parameter">topic</span>         主题
     * <span class="token keyword">@param</span> <span class="token parameter">subExpression</span> 订阅的标签
     * <span class="token keyword">@param</span> <span class="token parameter">messageModel</span>  消费模式，支持轮询和广播
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">MQClientException</span></span> MQClientException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createMqConsumer</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">&gt;</span></span> pushConsumer<span class="token punctuation">,</span>
                                        <span class="token class-name">String</span> group<span class="token punctuation">,</span>
                                        <span class="token class-name">String</span> nameServer<span class="token punctuation">,</span>
                                        <span class="token class-name">String</span> topic<span class="token punctuation">,</span>
                                        <span class="token class-name">MessageModel</span> messageModel<span class="token punctuation">,</span>
                                        <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> subExpression<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1 实例化消息生产者，指定组名</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2 指定Namesrv的地址信息</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span>nameServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3 订阅topic</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">MessageSelector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">MessageSelector</span><span class="token punctuation">)</span> subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>subExpression<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> subExpression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> subExpression<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;subExpression 参数异常&quot;</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 4 设置消费模式</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span>messageModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4 消费消息</span>
        pushConsumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5 启动消费者</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;consumer started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-2-顺序消息" tabindex="-1"><a class="header-anchor" href="#_4-2-顺序消息" aria-hidden="true">#</a> 4.2 顺序消息</h2><p>消息有序指的是可以按照消息的发送顺序来消费(FIFO)。RocketMQ可以严格的保证消息有序，可以分为分区有序或者全局有序。</p><p>顺序消费的原理解析，在默认的情况下消息发送会采取Round Robin轮询方式把消息发送到不同的queue(分区队列)；而消费消息的时候从多个queue上拉取消息，这种情况发送和消费是不能保证顺序。但是如果控制发送的顺序消息只依次发送到同一个queue中，消费的时候只从这个queue上依次拉取，则就保证了顺序。当发送和消费参与的queue只有一个，则是全局有序；如果多个queue参与，则为分区有序，即相对每个queue，消息都是有序的。</p><p>下面用订单进行分区有序的示例。一个订单的顺序流程是：创建、付款、推送、完成。订单号相同的消息会被先后发送到同一个队列中，消费时，同一个OrderId获取到的肯定是同一个队列。</p><h3 id="_4-2-1-顺序消息生产" tabindex="-1"><a class="header-anchor" href="#_4-2-1-顺序消息生产" aria-hidden="true">#</a> 4.2.1 顺序消息生产</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* Producer，发送顺序消息
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagD&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

       <span class="token comment">// 订单列表</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> dateStr <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 加个时间前缀</span>
           <span class="token class-name">String</span> body <span class="token operator">=</span> dateStr <span class="token operator">+</span> <span class="token string">&quot; Hello RocketMQ &quot;</span> <span class="token operator">+</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueueSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token annotation punctuation">@Override</span>
               <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> mqs<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token class-name">Long</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>  <span class="token comment">//根据订单id选择发送queue</span>
                   <span class="token keyword">long</span> index <span class="token operator">=</span> id <span class="token operator">%</span> mqs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">return</span> mqs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//订单id</span>

           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;SendResult status:%s, queueId:%d, body:%s&quot;</span><span class="token punctuation">,</span>
               sendResult<span class="token punctuation">.</span><span class="token function">getSendStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               sendResult<span class="token punctuation">.</span><span class="token function">getMessageQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token doc-comment comment">/**
    * 订单的步骤
    */</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OrderStep</span> <span class="token punctuation">{</span>
       <span class="token keyword">private</span> <span class="token keyword">long</span> orderId<span class="token punctuation">;</span>
       <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>

       <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> orderId<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token keyword">long</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>orderId <span class="token operator">=</span> orderId<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token string">&quot;OrderStep{&quot;</span> <span class="token operator">+</span>
               <span class="token string">&quot;orderId=&quot;</span> <span class="token operator">+</span> orderId <span class="token operator">+</span>
               <span class="token string">&quot;, desc=&#39;&quot;</span> <span class="token operator">+</span> desc <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span>
               <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token doc-comment comment">/**
    * 生成模拟订单数据
    */</span>
   <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">OrderStep</span> orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;推送&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> orderList<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-2-顺序消费消息" tabindex="-1"><a class="header-anchor" href="#_4-2-2-顺序消费消息" aria-hidden="true">#</a> 4.2.2 顺序消费消息</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 顺序消息消费，带事务方式（应用可控制Offset什么时候提交）
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerInOrder</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> 
           <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name_3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token doc-comment comment">/**
        * 设置Consumer第一次启动是从队列头部开始消费还是队列尾部开始消费<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        * 如果非第一次启动，那么按照上次消费的位置继续消费
        */</span>
       consumer<span class="token punctuation">.</span><span class="token function">setConsumeFromWhere</span><span class="token punctuation">(</span><span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span><span class="token constant">CONSUME_FROM_FIRST_OFFSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagA || TagC || TagD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerOrderly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

           <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token class-name">ConsumeOrderlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeOrderlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               context<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token comment">// 可以看到每个queue有唯一的consume线程来消费, 订单对每个queue(分区)有序</span>
                   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumeThread=&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;queueId=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, content:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>

               <span class="token keyword">try</span> <span class="token punctuation">{</span>
                   <span class="token comment">//模拟业务逻辑处理中...</span>
                   <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-3-延时消息" tabindex="-1"><a class="header-anchor" href="#_4-3-延时消息" aria-hidden="true">#</a> 4.3 延时消息</h2><p>比如电商里，提交了一个订单就可以发送一个延时消息，1h后去检查这个订单的状态，如果还是未付款就取消订单释放库存。</p><h3 id="_4-3-1-启动消息消费者" tabindex="-1"><a class="header-anchor" href="#_4-3-1-启动消息消费者" aria-hidden="true">#</a> 4.3.1 启动消息消费者</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageConsumer</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token comment">// 实例化消费者</span>
      <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleConsumer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 订阅Topics</span>
      consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 注册消息监听者</span>
      consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token annotation punctuation">@Override</span>
          <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> message <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// Print approximate delay time period</span>
                  <span class="token comment">// ps: 这里的getStoreTimestamp指的是存储的时间戳</span>
                  <span class="token comment">// 如果想看消息的初始时间戳的话，那么应该是getBornTimestamp</span>
                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Receive message[msgId=&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> message<span class="token punctuation">.</span><span class="token function">getStoreTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms later&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 启动消费者</span>
      consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-2-发送延时消息" tabindex="-1"><a class="header-anchor" href="#_4-3-2-发送延时消息" aria-hidden="true">#</a> 4.3.2 发送延时消息</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageProducer</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token comment">// 实例化一个生产者来产生延时消息</span>
      <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleProducerGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 启动生产者</span>
      producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> totalMessagesToSend <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalMessagesToSend<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello scheduled message &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 设置延时等级3,这个消息将在10s之后发送(现在只支持固定的几个时间,详看delayTimeLevel)</span>
          message<span class="token punctuation">.</span><span class="token function">setDelayTimeLevel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 发送消息</span>
          producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
       <span class="token comment">// 关闭生产者</span>
      producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-3-验证" tabindex="-1"><a class="header-anchor" href="#_4-3-3-验证" aria-hidden="true">#</a> 4.3.3 验证</h3><p>您将会看到消息的消费比存储时间晚10秒</p><h3 id="_4-3-4-使用限制" tabindex="-1"><a class="header-anchor" href="#_4-3-4-使用限制" aria-hidden="true">#</a> 4.3.4 使用限制</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// org/apache/rocketmq/store/config/MessageStoreConfig.java</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> messageDelayLevel <span class="token operator">=</span> <span class="token string">&quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>现在RocketMq并不支持任意时间的延时，需要设置几个固定的延时等级，从1s到2h分别对应着等级1到18</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>RocketMQ5.0支持自定义时间的延迟时间</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDelayTimeSec</span><span class="token punctuation">(</span><span class="token keyword">long</span> sec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">putProperty</span><span class="token punctuation">(</span><span class="token class-name">MessageConst</span><span class="token punctuation">.</span><span class="token constant">PROPERTY_TIMER_DELAY_SEC</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>sec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDelayTimeMs</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeMs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">putProperty</span><span class="token punctuation">(</span><span class="token class-name">MessageConst</span><span class="token punctuation">.</span><span class="token constant">PROPERTY_TIMER_DELAY_MS</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>timeMs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h2 id="_4-4-批量消息" tabindex="-1"><a class="header-anchor" href="#_4-4-批量消息" aria-hidden="true">#</a> 4.4 批量消息</h2><p>批量发送消息能显著提高传递小消息的性能。限制是这些批量消息应该有相同的topic，相同的waitStoreMsgOK，而且不能是延时消息。此外，这一批消息的总大小不应超过4MB。</p><h3 id="_4-4-1-发送批量消息" tabindex="-1"><a class="header-anchor" href="#_4-4-1-发送批量消息" aria-hidden="true">#</a> 4.4.1 发送批量消息</h3><p>如果您每次只发送不超过4MB的消息，则很容易使用批处理，样例如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token string">&quot;BatchTest&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 0&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID002&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
   producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//处理error</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果消息的总长度可能大于4MB时，这时候最好把消息进行分割</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListSplitter</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SIZE_LIMIT</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">int</span> currIndex<span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>messages <span class="token operator">=</span> messages<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span> 
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> currIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   	<span class="token annotation punctuation">@Override</span> 
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">int</span> nextIndex <span class="token operator">=</span> currIndex<span class="token punctuation">;</span>
       <span class="token keyword">int</span> totalSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> nextIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> nextIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">Message</span> message <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">int</span> tmpSize <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
           <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> properties<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               tmpSize <span class="token operator">+=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           tmpSize <span class="token operator">=</span> tmpSize <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 增加日志的开销20字节</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">&gt;</span> <span class="token constant">SIZE_LIMIT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">//单个消息超过了最大的限制</span>
               <span class="token comment">//忽略,否则会阻塞分裂的进程</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>nextIndex <span class="token operator">-</span> currIndex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">//假如下一个子列表没有元素,则添加这个子列表然后退出循环,否则只是退出循环</span>
                  nextIndex<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">+</span> totalSize <span class="token operator">&gt;</span> <span class="token constant">SIZE_LIMIT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               totalSize <span class="token operator">+=</span> tmpSize<span class="token punctuation">;</span>
           <span class="token punctuation">}</span>

       <span class="token punctuation">}</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> subList <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>currIndex<span class="token punctuation">,</span> nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
       currIndex <span class="token operator">=</span> nextIndex<span class="token punctuation">;</span>
       <span class="token keyword">return</span> subList<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4-1-1-如何使用" tabindex="-1"><a class="header-anchor" href="#_4-4-1-1-如何使用" aria-hidden="true">#</a> 4.4.1.1 如何使用</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//把大的消息分裂成若干个小的消息</span>
<span class="token class-name">ListSplitter</span> splitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>splitter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span>  listItem <span class="token operator">=</span> splitter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>listItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//处理error</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-5-过滤消息" tabindex="-1"><a class="header-anchor" href="#_4-5-过滤消息" aria-hidden="true">#</a> 4.5 过滤消息</h2><p>在大多数情况下，TAG是一个简单而有用的设计，其可以来选择您想要的消息。例如：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;CID_EXAMPLE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TAGA || TAGB || TAGC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>消费者将接收包含TAGA或TAGB或TAGC的消息。但是限制是一个消息只能有一个标签，这对于复杂的场景可能不起作用。在这种情况下，可以使用SQL表达式筛选消息。SQL特性可以通过发送消息时的属性来进行计算。在RocketMQ定义的语法下，可以实现一些简单的逻辑。下面是一个例子：</p><div class="language-te line-numbers-mode" data-ext="te"><pre class="language-te"><code>------------
| message  |
|----------|  a &gt; 5 AND b = &#39;abc&#39;
| a = 10   |  --------------------&gt; Gotten
| b = &#39;abc&#39;|
| c = true |
------------
------------
| message  |
|----------|   a &gt; 5 AND b = &#39;abc&#39;
| a = 1    |  --------------------&gt; Missed
| b = &#39;abc&#39;|
| c = true |
------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-1-sql基本语法" tabindex="-1"><a class="header-anchor" href="#_4-5-1-sql基本语法" aria-hidden="true">#</a> 4.5.1 SQL基本语法</h3><p>RocketMQ只定义了一些基本语法来支持这个特性。你也可以很容易地扩展它。</p><ul><li>数值比较，比如：<strong>&gt;，&gt;=，&lt;，&lt;=，BETWEEN，=；</strong></li><li>字符比较，比如：<strong>=，&lt;&gt;，IN；</strong></li><li><strong>IS NULL</strong> 或者 <strong>IS NOT NULL；</strong></li><li>逻辑符号 <strong>AND，OR，NOT；</strong></li></ul><p>常量支持类型为：</p><ul><li>数值，比如：<strong>123，3.1415；</strong></li><li>字符，比如：<strong>&#39;abc&#39;，必须用单引号包裹起来；</strong></li><li><strong>NULL</strong>，特殊的常量</li><li>布尔值，<strong>TRUE</strong> 或 <strong>FALSE</strong></li></ul><p>只有使用push模式的消费者才能用使用SQL92标准的sql语句，接口如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span>finalString topic<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">MessageSelector</span> messageSelector<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-5-2-消息生产者" tabindex="-1"><a class="header-anchor" href="#_4-5-2-消息生产者" aria-hidden="true">#</a> 4.5.2 消息生产者</h3><p>发送消息时，你能通过<code>putUserProperty</code>来设置消息的属性</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
   tag<span class="token punctuation">,</span>
   <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置一些属性</span>
msg<span class="token punctuation">.</span><span class="token function">putUserProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-3-消息消费者" tabindex="-1"><a class="header-anchor" href="#_4-5-3-消息消费者" aria-hidden="true">#</a> 4.5.3 消息消费者</h3><p>用MessageSelector.bySql来使用sql筛选消息</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name_4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 只有订阅的消息有这个属性a, a &gt;=0 and a &lt;= 3</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MessageSelector</span><span class="token punctuation">.</span><span class="token function">bySql</span><span class="token punctuation">(</span><span class="token string">&quot;a between 0 and 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-5-3-1-异常the-broker-does-not-support-consumer-to-filter-message-by-sql92" tabindex="-1"><a class="header-anchor" href="#_4-5-3-1-异常the-broker-does-not-support-consumer-to-filter-message-by-sql92" aria-hidden="true">#</a> 4.5.3.1 异常<code>The broker does not support consumer to filter message by SQL92</code></h4><div class="language-verilog line-numbers-mode" data-ext="verilog"><pre class="language-verilog"><code>Exception in thread <span class="token string">&quot;main&quot;</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>MQClientException<span class="token punctuation">:</span> CODE<span class="token punctuation">:</span> <span class="token number">1</span>  DESC<span class="token punctuation">:</span> The broker does <span class="token keyword">not</span> support consumer to filter message by SQL92
For more information<span class="token punctuation">,</span> please visit the url<span class="token punctuation">,</span> https<span class="token punctuation">:</span><span class="token comment">//rocketmq.apache.org/docs/bestPractice/06FAQ</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>MQClientAPIImpl<span class="token punctuation">.</span><span class="token function">checkClientInBroker</span><span class="token punctuation">(</span>MQClientAPIImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">2806</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>MQClientInstance<span class="token punctuation">.</span><span class="token function">checkClientInBroker</span><span class="token punctuation">(</span>MQClientInstance<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">443</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>DefaultMQPushConsumerImpl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>DefaultMQPushConsumerImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">989</span><span class="token punctuation">)</span>
	at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>DefaultMQPushConsumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>DefaultMQPushConsumer<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">737</span><span class="token punctuation">)</span>
	at cn<span class="token punctuation">.</span>lyf<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>RocketMqUtil<span class="token punctuation">.</span><span class="token function">createMqConsumer</span><span class="token punctuation">(</span>RocketMqUtil<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">88</span><span class="token punctuation">)</span>
	at cn<span class="token punctuation">.</span>lyf<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>FilterMessageDemo<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>FilterMessageDemo<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406175608649-9ebb5bfc.png" alt="image-20230406175608649" tabindex="0" loading="lazy"><figcaption>image-20230406175608649</figcaption></figure><h4 id="_4-5-3-2-解决办法" tabindex="-1"><a class="header-anchor" href="#_4-5-3-2-解决办法" aria-hidden="true">#</a> 4.5.3.2 解决办法</h4><h5 id="_1-编辑broker-conf文件" tabindex="-1"><a class="header-anchor" href="#_1-编辑broker-conf文件" aria-hidden="true">#</a> 1 编辑broker.conf文件</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /data/rocketmq/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2-添加属性" tabindex="-1"><a class="header-anchor" href="#_2-添加属性" aria-hidden="true">#</a> 2 添加属性</h5><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># 添加RocketMQ对SQL92的支持</span>
<span class="token key attr-name">enablePropertyFilter</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image-20230406180026145-80f91dab.png" alt="image-20230406180026145" tabindex="0" loading="lazy"><figcaption>image-20230406180026145</figcaption></figure><h5 id="_3-重启rocketmq" tabindex="-1"><a class="header-anchor" href="#_3-重启rocketmq" aria-hidden="true">#</a> 3 重启RocketMQ</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看当前运行容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
<span class="token comment"># 重启RocketMQ brocker</span>
<span class="token function">docker</span> restart rmqbroker

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-再次启动消费者" tabindex="-1"><a class="header-anchor" href="#_4-再次启动消费者" aria-hidden="true">#</a> 4 再次启动消费者</h5><figure><img src="/assets/image-20230406180229308-069c6d6c.png" alt="image-20230406180229308" tabindex="0" loading="lazy"><figcaption>image-20230406180229308</figcaption></figure><h2 id="_4-6-事务消息" tabindex="-1"><a class="header-anchor" href="#_4-6-事务消息" aria-hidden="true">#</a> 4.6 事务消息</h2><h3 id="_4-6-1-流程分析" tabindex="-1"><a class="header-anchor" href="#_4-6-1-流程分析" aria-hidden="true">#</a> 4.6.1 流程分析</h3><figure><img src="/assets/事务消息-af8dff93.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>上图说明了事务消息的大致方案，其中分为两个流程：正常事务消息的发送及提交、事务消息的补偿流程。</p><h4 id="_1-事务消息发送及提交" tabindex="-1"><a class="header-anchor" href="#_1-事务消息发送及提交" aria-hidden="true">#</a> 1）事务消息发送及提交</h4><p>(1) 发送消息（half消息）。</p><p>(2) 服务端响应消息写入结果。</p><p>(3) 根据发送结果执行本地事务（如果写入失败，此时half消息对业务不可见，本地逻辑不执行）。</p><p>(4) 根据本地事务状态执行Commit或者Rollback（Commit操作生成消息索引，消息对消费者可见）</p><h4 id="_2-事务补偿" tabindex="-1"><a class="header-anchor" href="#_2-事务补偿" aria-hidden="true">#</a> 2）事务补偿</h4><p>(1) 对没有Commit/Rollback的事务消息（pending状态的消息），从服务端发起一次“回查”</p><p>(2) Producer收到回查消息，检查回查消息对应的本地事务的状态</p><p>(3) 根据本地事务状态，重新Commit或者Rollback</p><p>其中，补偿阶段用于解决消息Commit或者Rollback发生超时或者失败的情况。</p><h4 id="_3-事务消息状态" tabindex="-1"><a class="header-anchor" href="#_3-事务消息状态" aria-hidden="true">#</a> 3）事务消息状态</h4><p>事务消息共有三种状态，提交状态、回滚状态、中间状态：</p><ul><li>TransactionStatus.CommitTransaction: 提交事务，它允许消费者消费此消息。</li><li>TransactionStatus.RollbackTransaction: 回滚事务，它代表该消息将被删除，不允许被消费。</li><li>TransactionStatus.Unknown: 中间状态，它代表需要检查消息队列来确定状态。</li></ul><h3 id="_4-6-2-发送事务消息" tabindex="-1"><a class="header-anchor" href="#_4-6-2-发送事务消息" aria-hidden="true">#</a> 4.6.2 发送事务消息</h3><h4 id="_1-创建事务性生产者" tabindex="-1"><a class="header-anchor" href="#_1-创建事务性生产者" aria-hidden="true">#</a> 1) 创建事务性生产者</h4><p>使用 <code>TransactionMQProducer</code>类创建生产者，并指定唯一的 <code>ProducerGroup</code>，就可以设置自定义线程池来处理这些检查请求。执行本地事务后、需要根据执行结果对消息队列进行回复。回传的事务状态在请参考前一节。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建事务监听器</span>
        <span class="token class-name">TransactionListener</span> transactionListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionListenerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建消息生产者</span>
        <span class="token class-name">TransactionMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;group6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.25.135:9876;192.168.25.138:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//生产者这是监听器</span>
        producer<span class="token punctuation">.</span><span class="token function">setTransactionListener</span><span class="token punctuation">(</span>transactionListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//启动消息生产者</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TransactionTopic&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">sendMessageInTransaction</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//producer.shutdown();</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-实现事务的监听接口" tabindex="-1"><a class="header-anchor" href="#_2-实现事务的监听接口" aria-hidden="true">#</a> 2）实现事务的监听接口</h4><p>当发送半消息成功时，我们使用 <code>executeLocalTransaction</code> 方法来执行本地事务。它返回前一节中提到的三个事务状态之一。<code>checkLocalTranscation</code> 方法用于检查本地事务状态，并回应消息队列的检查请求。它也是返回前一节中提到的三个事务状态之一。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionListenerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransactionListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">executeLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行本地事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">ROLLBACK_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOW</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">checkLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MQ检查消息Tag【&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;】的本地事务执行结果&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-3-使用限制" tabindex="-1"><a class="header-anchor" href="#_4-6-3-使用限制" aria-hidden="true">#</a> 4.6.3 使用限制</h3><ol><li>事务消息不支持延时消息和批量消息。</li><li>为了避免单个消息被检查太多次而导致半队列消息累积，我们默认将单个消息的检查次数限制为 15 次，但是用户可以通过 Broker 配置文件的 <code>transactionCheckMax</code>参数来修改此限制。如果已经检查某条消息超过 N 次的话（ N = <code>transactionCheckMax</code> ） 则 Broker 将丢弃此消息，并在默认情况下同时打印错误日志。用户可以通过重写 <code>AbstractTransactionCheckListener</code> 类来修改这个行为。</li><li>事务消息将在 Broker 配置文件中的参数 transactionMsgTimeout 这样的特定时间长度之后被检查。当发送事务消息时，用户还可以通过设置用户属性 CHECK_IMMUNITY_TIME_IN_SECONDS 来改变这个限制，该参数优先于 <code>transactionMsgTimeout</code> 参数。</li><li>事务性消息可能不止一次被检查或消费。</li><li>提交给用户的目标主题消息可能会失败，目前这依日志的记录而定。它的高可用性通过 RocketMQ 本身的高可用性机制来保证，如果希望确保事务消息不丢失、并且事务完整性得到保证，建议使用同步的双重写入机制。</li><li>事务消息的生产者 ID 不能与其他类型消息的生产者 ID 共享。与其他类型的消息不同，事务消息允许反向查询、MQ服务器能通过它们的生产者 ID 查询到消费者。</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/lyf110/lyf110.github.io/edit/main/docs/notes/cloud/mq/rocketmq/RocketMQ-01.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 1102970594@qq.com">lyf110</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><!----><a href="/notes/cloud/mq/rocketmq/RocketMQ-02.html" class="nav-link next" aria-label="二、RocketMQ入门第二天"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">二、RocketMQ入门第二天<!----></div></a></nav><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">主题 <a href="https://theme-hope.vuejs.press/zh/">vuepress-theme-hope</a> | Apache License 2.0 Licensed</div><div class="copyright">Copyright © 2023-present liu yang fang</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-ce1c9f9d.js" defer></script>
  </body>
</html>
